<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Django ORM | Abo Tyim</title><meta name=keywords content="Django,Django-ORM,ORM"><meta name=description content="Django ORM ‚Äî Object Relation Mapper is a powerful and elegant way to interact with the database. The Django ORM is an abstraction layer that allows us to play with the database."><meta name=author content="AboTyim"><link rel=canonical href=https://abotyim.github.io/en/posts/django/orm/><link crossorigin=anonymous href=/assets/css/stylesheet.min.48a18943c2fc15c38a372b8dde1f5e5dc0bc64fa6cb90f5a817d2f8c76b7f3ae.css integrity="sha256-SKGJQ8L8FcOKNyuN3h9eXcC8ZPpsuQ9agX0vjHa3864=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.min.b95bacdc39e37a332a9f883b1e78be4abc1fdca2bc1f2641f55e3cd3dabd4d61.js integrity="sha256-uVus3DnjejMqn4g7Hni+Srwf3KK8HyZB9V4809q9TWE=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://abotyim.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://abotyim.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://abotyim.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://abotyim.github.io/apple-touch-icon.png><link rel=mask-icon href=https://abotyim.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://abotyim.github.io/en/posts/django/orm/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Django ORM"><meta property="og:description" content="Django ORM ‚Äî Object Relation Mapper is a powerful and elegant way to interact with the database. The Django ORM is an abstraction layer that allows us to play with the database."><meta property="og:type" content="article"><meta property="og:url" content="https://abotyim.github.io/en/posts/django/orm/"><meta property="og:image" content="https://abotyim.github.io/posts/python/django-orm.jpg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-10-21T00:00:00+00:00"><meta property="article:modified_time" content="2021-10-21T00:00:00+00:00"><meta property="og:site_name" content="Abo Tyim"><meta property="og:see_also" content="https://abotyim.github.io/en/posts/resources/python/"><meta property="og:see_also" content="https://abotyim.github.io/en/posts/resources/django/"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://abotyim.github.io/posts/python/django-orm.jpg"><meta name=twitter:title content="Django ORM"><meta name=twitter:description content="Django ORM ‚Äî Object Relation Mapper is a powerful and elegant way to interact with the database. The Django ORM is an abstraction layer that allows us to play with the database."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":5,"name":"Django ORM","item":"https://abotyim.github.io/en/posts/django/orm/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Django ORM","name":"Django ORM","description":"Django ORM ‚Äî Object Relation Mapper is a powerful and elegant way to interact with the database. The Django ORM is an abstraction layer that allows us to play with the database.","keywords":["Django","Django-ORM","ORM"],"articleBody":"Methods That Return QuerySets: Method Description filter() Filter by the given lookup parameters. Multiple parameters are joined by SQL AND statements exclude() Filter by objects that don‚Äôt match the given lookup parameters order_by() Change the default ordering of the QuerySet reverse() Reverse the default ordering of the QuerySet distinct() Perform an SQL SELECT DISTINCT query to eliminate duplicate rows values() Returns dictionaries instead of model instances values_list() Returns tuples instead of model instances dates() Returns a QuerySet containing all available dates in the specified date range datetimes() Returns a QuerySet containing all available dates in the specified date and time range none() Create an empty QuerySet all() Return a copy of the current QuerySet union() Use the SQL UNION operator to combine two or more QuerySets intersection() Use the SQL INTERSECT operator to return the shared elements of two or more QuerySets difference() Use the SQL EXCEPT operator to return elements in the first QuerySet that are not in the others select_related() Select all related data when executing the query (except many-to-many relationships) prefetch_related() Select all related data when executing the query (including many-to-many relationships) defer() Do not retrieve the names fields from the database. Used to improve query performance on complex datasets only() Opposite of **defer() : **return only the name fields using() Select which database the QuerySet will be evaluated against (when using multiple databases) select_for_update() Return a QuerySet that will lock rows until the end of the transaction raw() Execute a raw SQL statement AND (\u0026) Combine two QuerySets with the SQL AND operator. Using AND (\u0026) is functionally equivalent to using filter() with multiple parameters OR (|) Combine two QuerySets with the SQL OR operator annotate() Annotate each object in the QuerySet. Annotations can be simple values, a field reference or an aggregate expression Let‚Äôs go ahead and use the Django interactive shell to explore a few examples of the more common QuerySet methods.\nfilter() queryset = User.objects.filter(first_name='Ahmed') queryset \u003cQuerySet [\u003cUser: Ahmed\u003e, \u003cUser: Ahmed\u003e, \u003cUser: Ahmed\u003e]\u003e exclude() return a QuerySet of objects that don‚Äôt match the given lookup parameters, for example:\n\u003e\u003e\u003e from events.models import Venue \u003e\u003e\u003e Venue.objects.exclude(name=\"South Stadium\") \u003cQuerySet [\u003cVenue: West Park\u003e, \u003cVenue: North Stadium\u003e, \u003cVenue: East Park\u003e]\u003e Using more than one lookup parameter will use an SQL AND operator under the hood:\n\u003e\u003e\u003e from events.models import Event \u003e\u003e\u003e import datetime \u003e\u003e\u003e venue1 = Venue.objects.get(name=\"East Park\") \u003e\u003e\u003e Event.objects.exclude(venue=venue1,event_date=datetime.date(2019,10,8)) \u003cQuerySet [\u003cEvent: Test Event\u003e, \u003cEvent: Club Presentation - Juniors\u003e, \u003cEvent: Club Presentation - Seniors\u003e, \u003cEvent: Gala Day\u003e]\u003e order_by() and reverse() order_by() changes the default ordering of the QuerySet. Function parameters are the model fields to use to order the QuerySet. Ordering can be single level:\n\u003e\u003e\u003e from events.models import Event \u003e\u003e\u003e Event.objects.all().order_by('name') \u003cQuerySet [\u003cEvent: Club Presentation - Juniors\u003e, \u003cEvent: Club Presentation - Seniors\u003e, \u003cEvent: Gala Day\u003e, \u003cEvent: Test Event\u003e]\u003e Or ordering can be multi-level. In the following example, the events are first ordered by event date and then by event name:\n\u003e\u003e\u003e Event.objects.all().order_by('event_date','name') \u003cQuerySet [\u003cEvent: Club Presentation - Juniors\u003e, \u003cEvent: Club Presentation - Seniors\u003e, \u003cEvent: Gala Day\u003e, \u003cEvent: Test Event\u003e]\u003e By default, QuerySet fields are ordered in ascending order. To sort in descending order, use the negative sign**(-)**:\n\u003e\u003e\u003e Event.objects.all().order_by('-name') \u003cQuerySet [\u003cEvent: Test Event\u003e, \u003cEvent: Gala Day\u003e, \u003cEvent: Club Presentation - Seniors\u003e, \u003cEvent: Club Presentation - Juniors\u003e]\u003e reverse() reverses the default ordering of the QuerySet:\n\u003e\u003e\u003e Event.objects.all().reverse() \u003cQuerySet [\u003cEvent: Test Event\u003e, \u003cEvent: Club Presentation - Juniors\u003e, \u003cEvent: Club Presentation - Seniors\u003e, \u003cEvent: Gala Day\u003e]\u003e Note:\nA model must have default ordering (by setting the ordering option of the models Meta class) for reverse() to be useful. If the model is unordered, the sort order of the returned QuerySet will be meaningless. Both order_by() and reverse() are not free operations‚Äîthey come at a time cost to your database and should be used sparingly on large datasets. values() and values_list() values() returns Python dictionaries, instead of a QuerySet object:\n\u003e\u003e\u003e Event.objects.values() \u003cQuerySet [{'id': 1, 'name': 'Test Event', 'event_date': datetime.datetime(2019, 8, 25, 22, 42, 15, tzinfo=\u003cUTC\u003e), 'venue_id': 1, 'manager_id': 1, 'description': \"It's all happening here!\"}, {'id': 2, 'name': 'Club Presentation - Juniors', 'event_date': datetime.datetime(2019, 8, 1, 12, 0, tzinfo=\u003cUTC\u003e), 'venue_id': 4, 'manager_id': 2, 'description': ''}]\u003e You can also specify which fields you want returned:\n\u003e\u003e\u003e Event.objects.values('name','description') \u003cQuerySet [{'name': 'Test Event', 'description': \"It's all happening here!\"}, {'name': 'Club Presentation - Juniors', 'description': ''}]\u003e values_list() is the same as values(), except it returns tuples:\n\u003e\u003e\u003e Event.objects.values_list() \u003cQuerySet [(1, 'Test Event', datetime.datetime(2019, 8, 25, 22, 42, 15, tzinfo=\u003cUTC\u003e), 1, 1, \"It's all happening here!\"), (2, 'Club Presentation - Juniors', datetime.datetime(2019, 8, 1, 12, 0, tzinfo=\u003cUTC\u003e), 4, 2, '')]\u003e You can also specify which fields to return:\n\u003e\u003e\u003e Event.objects.values_list('name') \u003cQuerySet [('Test Event',), ('Club Presentation - Juniors',)]\u003e dates() and datetimes() You use the dates() and datetimes() methods to return time-bounded records from the database (for example, all the events occuring in a particular month). For dates(), these time bounds are year, month, week and day. datetimes() adds hour, minute and second bounds. Some examples:\n\u003e\u003e\u003e from events.models import Event \u003e\u003e\u003e Event.objects.dates('event_date', 'year') \u003cQuerySet [datetime.date(2019, 1, 1)]\u003e \u003e\u003e\u003e Event.objects.dates('event_date', 'month') \u003cQuerySet [datetime.date(2019, 8, 1)]\u003e \u003e\u003e\u003e Event.objects.dates('event_date', 'week') \u003cQuerySet [datetime.date(2019, 7, 29), datetime.date(2019, 8, 5), datetime.date(2019, 8, 19)]\u003e \u003e\u003e\u003e Event.objects.dates('event_date', 'day') \u003cQuerySet [datetime.date(2019, 8, 1), datetime.date(2019, 8, 10), datetime.date(2019, 8, 11), datetime.date(2019, 8, 25)]\u003e union() The UNION operator is used to combine the result-set of two or more querysets. The querysets can be from the same or from different models. When they querysets are from different models, the fields and their datatypes should match.\n\u003e\u003e\u003e q1 = User.objects.filter(id__gte=5) \u003e\u003e\u003e q1 \u003cQuerySet [\u003cUser: Ritesh\u003e, \u003cUser: Billy\u003e, \u003cUser: Radha\u003e, \u003cUser: sohan\u003e, \u003cUser: Raghu\u003e, \u003cUser: rishab\u003e]\u003e \u003e\u003e\u003e q2 = User.objects.filter(id__lte=9) \u003e\u003e\u003e q2 \u003cQuerySet [\u003cUser: yash\u003e, \u003cUser: John\u003e, \u003cUser: Ricky\u003e, \u003cUser: sharukh\u003e, \u003cUser: Ritesh\u003e, \u003cUser: Billy\u003e, \u003cUser: Radha\u003e, \u003cUser: sohan\u003e, \u003cUser: Raghu\u003e]\u003e \u003e\u003e\u003e q1.union(q2) \u003cQuerySet [\u003cUser: yash\u003e, \u003cUser: John\u003e, \u003cUser: Ricky\u003e, \u003cUser: sharukh\u003e, \u003cUser: Ritesh\u003e, \u003cUser: Billy\u003e, \u003cUser: Radha\u003e, \u003cUser: sohan\u003e, \u003cUser: Raghu\u003e, \u003cUser: rishab\u003e]\u003e \u003e\u003e\u003e q2.union(q1) \u003cQuerySet [\u003cUser: yash\u003e, \u003cUser: John\u003e, \u003cUser: Ricky\u003e, \u003cUser: sharukh\u003e, \u003cUser: Ritesh\u003e, \u003cUser: Billy\u003e, \u003cUser: Radha\u003e, \u003cUser: sohan\u003e, \u003cUser: Raghu\u003e, \u003cUser: rishab\u003e]\u003e Since Hero and Villain both have the name and gender, we can use values_list to limit the selected fields then do a union.\nHero.objects.all().values_list( \"name\", \"gender\" ).union( Villain.objects.all().values_list( \"name\", \"gender\" )) This would give you all Hero and Villain objects with their name and gender.\nselect_related() and prefetch_related() Selecting related information can be a database-intensive operation as each foreign key relationship requires an additional database lookup. For example, each Event object in our database has a foreign key realtionship with the Venue table:\n\u003e\u003e\u003e event1 = Event.objects.get(id=1) \u003e\u003e\u003e event1.venue # Foreign key retrieval causes additional database hit \u003cVenue: South Stadium\u003e For our simple example, this is not a problem, but in large databases with many foreign key relationships, the load on the database can be prohibitive.\nYou use select_related() to improve database performance by retrieving all related data the first time the database is hit:\n\u003e\u003e\u003e event2 = Event.objects.select_related('venue').get(id=2) \u003e\u003e\u003e event2.venue # venue has already been retrieved. Database is not hit again. \u003cVenue: East Park\u003e prefetch_related() works the same way as select_related(), except it will work across many-to-many relationships.\nonly() \u003e\u003e\u003e queryset = User.objects.filter( first_name__startswith='R' ).only(\"first_name\", \"last_name\") The only difference between only and values is only also fetches the id.\nannotate() Annotations can be simple values, a field reference or an aggregate expression. For example, let‚Äôs use Django‚Äôs Count aggregate function to annotate our Event model with a total of all users attending each event:\n\u003e\u003e\u003e from events.models import Event \u003e\u003e\u003e from django.db.models import Count \u003e\u003e\u003e qry = Event.objects.annotate(total_attendees=Count('attendees')) \u003e\u003e\u003e for event in qry: ... print(event.name, event.total_attendees) ... Test Event 0 Gala Day 2 Club Presentation - Juniors 5 Club Presentation - Seniors 3 \u003e\u003e\u003e raw() Executing Raw SQL\nWhile Django‚Äôs developers provide the raw() query method for executing raw SQL, you are explicitly discouraged from doing so.\nThe Django ORM is very powerful and in the vast majority of cases where I have seen programmers resort to SQL it has been due to an incomplete knowledge of Django‚Äôs ORM on the programmers part, not a deficiency in the ORM.\nIf you find yourself in the situation where a query is so complex you can‚Äôt find a way of completing the task with Django‚Äôs ORM, it‚Äôs likely you need to create a stored procedure or a new view within the database itself.\nMethods That Don‚Äôt Return QuerySets: Method Description get() Returns a single object. Throws an error if lookup returns multiple objects create() Shortcut method to create and save an object in one step get_or_create() Returns a single object. If the object doesn‚Äôt exist, it creates one update_or_create() Updates a single object. If the object doesn‚Äôt exist, it creates one bulk_create() Insert a list of objects in the database bulk_update() Update given fields in the listed model instances count() Count the number of objects in the returned QuerySet. Returns an integer in_bulk() Return a QuerySet containing all objects with the listed IDs iterator() Evaluate a QuerySet and return an iterator over the results. Can improve performance and memory use for queries that return a large number of objects latest() Return the latest object in the database table based on the given field(s) earliest() Return the earliest object in the database table based on the given field(s) first() Return the first object matched by the QuerySet last() Return the last object matched by the QuerySet aggregate() Return a dictionary of aggregate values calculated over the QuerySet exists() Returns True if the QuerySet contains any results update() Performs an SQL UPDATE on the specified field(s) delete() Performs an SQL DELETE that deletes all rows in the QuerySet as_manager() Return a Manager class instance containing a copy of the QuerySet‚Äôs methods explain() Returns a string of the QuerySet‚Äôs execution plan. Used for analysing query performance Let‚Äôs return to the Django interactive shell to dig deeper into some common examples:\nget_or_create() get_or_create() will attempt to retrieve a record matching the search fields. If a record doesn‚Äôt exist, it will create one. The return value will be a tuple‚Äîthe created or retrieved object and a boolean value that will be True if a new record was created:\n\u003e\u003e\u003e from events.models import MyclubUser \u003e\u003e\u003e usr, boolCreated = MyclubUser.objects.get_or_create(first_name='John', last_name='Jones', email='johnj@example.com') \u003e\u003e\u003e usr \u003cMyclubUser: John Jones\u003e \u003e\u003e\u003e boolCreated True If we try and create the object a second time, it will retrieve the new record from the database instead.\n\u003e\u003e\u003e usr, boolCreated = MyclubUser.objects.get_or_create(first_name='John', last_name='Jones', email='johnj@example.com') \u003e\u003e\u003e usr \u003cMyclubUser: John Jones\u003e \u003e\u003e\u003e boolCreated False update_or_create() update_or_create() works similar to get_or_create(), except you pass the search fields and a dictionary named defaults that contains the fields to update. If the object doesn‚Äôt exist, it will create a new record in the database:\n\u003e\u003e\u003e usr, boolCreated = MyclubUser.objects.update_or_create(first_name='Mary', last_name='Jones', defaults={'email':'maryj@example.com'}) \u003e\u003e\u003e usr \u003cMyclubUser: Mary Jones\u003e \u003e\u003e\u003e boolCreated True If the record does exist, Django will update all fields listed in the defaults dictionary:\n\u003e\u003e\u003e usr, boolCreated = MyclubUser.objects.update_or_create(first_name='Mary', last_name='Jones', defaults={'email':'mary_j@example.com'}) \u003e\u003e\u003e usr \u003cMyclubUser: Mary Jones\u003e \u003e\u003e\u003e usr.email 'mary_j@example.com' \u003e\u003e\u003e boolCreated False bulk_create() and bulk_update() The bulk_create() saves time by inserting multiple objects into the database at once, most often in a single query. The function has on required parameter‚Äîa list of objects:\n\u003e\u003e\u003e usrs = MyclubUser.objects.bulk_create([ ... MyclubUser(first_name='Jane', last_name='Smith', email='janes@example.com'), ... MyclubUser(first_name='Steve', last_name='Smith', email='steves@example.com'), ... ]) bulk_update() on the other hand takes a list of model objects and updates individual fields on selected model instances. For example, let‚Äôs say the first two ‚ÄúSmiths‚Äù in the database were entered incorrectly. First, we retrieve all the ‚ÄúSmiths‚Äù:\n\u003e\u003e\u003e usrs = MyclubUser.objects.filter(last_name='Smith') \u003e\u003e\u003e usrs \u003cQuerySet [\u003cMyclubUser: Joe Smith\u003e, \u003cMyclubUser: Jane Smith\u003e, \u003cMyclubUser: Steve Smith\u003e]\u003e We can then modify the last_name field on the first two instances and use the bulk_update function to save the changes to the database in a single query:\n\u003e\u003e\u003e usrs[0].last_name = 'Smythe' \u003e\u003e\u003e usrs[1].last_name = 'Smythe' \u003e\u003e\u003e MyclubUser.objects.bulk_update(usrs, ['last_name']) \u003e\u003e\u003e usrs \u003cQuerySet [\u003cMyclubUser: Joe Smythe\u003e, \u003cMyclubUser: Jane Smythe\u003e, \u003cMyclubUser: Steve Smith\u003e]\u003e count() Count the number of objects in the QuerySet. Can be used to count all the objects in a database table:\n\u003e\u003e\u003e MyclubUser.objects.count() 9 Or used to count the number of objects returned by a query:\n\u003e\u003e\u003e MyclubUser.objects.filter(last_name='Smythe').count() 2 count() is functionally equivalent to using the aggregate() function, for example:\n\u003e\u003e\u003e MyclubUser.objects.all().aggregate(Count('id')) {'id__count': 9} But count() has a cleaner syntax and is likely to be faster on larger datasets.\nin_bulk() in_bulk() takes a list of id values and returns a dictionary mapping each id to an instance of the object with that id. If you don‚Äôt pass a list to **in_bulk()**, all objects will be returned:\n\u003e\u003e\u003e MyclubUser.objects.in_bulk() {1: \u003cMyclubUser: Joe Smythe\u003e, 2: \u003cMyclubUser: Jane Doe\u003e, 3: \u003cMyclubUser: John Jones\u003e} Once retrieved, you can access each object by their key value:\n\u003e\u003e\u003e usrs[3] \u003cMyclubUser: John Jones\u003e \u003e\u003e\u003e usrs[3].first_name 'John' Any non-empty list will retrieve all records with the listed ids:\n\u003e\u003e\u003e MyclubUser.objects.in_bulk([1]) {1: \u003cMyclubUser: Joe Smythe\u003e} List ids don‚Äôt have to be sequential either:\n\u003e\u003e\u003e MyclubUser.objects.in_bulk([1, 3, 7]) {1: \u003cMyclubUser: Joe Smythe\u003e, 3: \u003cMyclubUser: John Jones\u003e, 7: \u003cMyclubUser: Mary Jones\u003e} latest() and earliest() Return the latest or the earliest date in the database for the provided field(s):\n\u003e\u003e\u003e from events.models import Event \u003e\u003e\u003e Event.objects.latest('event_date') \u003cEvent: Test Event\u003e \u003e\u003e\u003e Event.objects.earliest('event_date') \u003cEvent: Club Presentation - Juniors\u003e first() an last() Return the first or last object in the QuerySet:\n\u003e\u003e\u003e Event.objects.first() \u003cEvent: Test Event\u003e \u003e\u003e\u003e Event.objects.last() \u003cEvent: Gala Day\u003e aggregate() Returns a dictionary of aggregate values calculated over the QuerySet. For example:\n\u003e\u003e\u003e from django.db.models import Count \u003e\u003e\u003e Event.objects.aggregate(Count('attendees')) {'attendees__count': 7} \u003e\u003e\u003e For a list of all aggregate functions available in Django, see Aggregate Functions later in this chapter.\nexists() Returns True if the returned QuerySet contains any objects, False if the QuerySet is empty. There are two common use cases‚Äîto check if an object is contained in another QuerySet:\n\u003e\u003e\u003e from events.models import MyclubUser # Let's retrieve John Jones from the database \u003e\u003e\u003e usr = MyclubUser.objects.get(first_name='John', last_name='Jones') # And check to make sure he is one of the Joneses \u003e\u003e\u003e joneses = MyclubUser.objects.filter(last_name='Jones') \u003e\u003e\u003e joneses.filter(pk=usr.pk).exists() True And to check if a query returns an object:\n\u003e\u003e\u003e joneses.filter(first_name='Mary').exists() True \u003e\u003e\u003e joneses.filter(first_name='Peter').exists() False Field Lookups: Field lookups have a simple double-underscore syntax:\n\u003csearchfield\u003e__\u003clookup\u003e For example:\n\u003e\u003e\u003e MyclubUser.objects.filter(first_name__exact=\"Sally\") \u003cQuerySet [\u003cMyclubUser: Sally Jones\u003e]\u003e \u003e\u003e\u003e MyclubUser.objects.filter(first_name__contains=\"Sally\") \u003cQuerySet [\u003cMyclubUser: Sally Jones\u003e, \u003cMyclubUser: Sally-Anne Jones\u003e]\u003e Under the hood, Django creates SQL WHERE clauses to construct database queries from the applied lookups. Multiple lookups are allowed and field lookups can also be chained (where logical):\n\u003e\u003e\u003e from events.models import Event # Get all events in 2019 that occur before September \u003e\u003e\u003e Event.objects.filter(event_date__year=2019, event_date__month__lt=9) \u003cQuerySet [\u003cEvent: Test Event\u003e, \u003cEvent: Club Presentation - Juniors\u003e, \u003cEvent: Club Presentation - Seniors\u003e, \u003cEvent: Gala Day\u003e]\u003e \u003e\u003e\u003e # Get all events occuring on or after the 10th of the month \u003e\u003e\u003e Event.objects.filter(event_date__day__gte=10) \u003cQuerySet [\u003cEvent: Test Event\u003e, \u003cEvent: Club Presentation - Seniors\u003e, \u003cEvent: Gala Day\u003e]\u003e Filter Description exact/iexact Exact match. iexact is case-insensitive version contains/icontains Field contains search text. icontains is case-insensitive version in In a given iterable (list, tuple or QuerySet) gt/gte Greater than/greater than or equal lt/lte Less than/less than or equal startswith/istartswith Starts with search string. istartswith is case-insensitive version endswith/iendswith Ends with search string. iendswithis case-insensitive version range Range test. Range includes start and finish values date Casts the value as a date. For datetime field lookups year Searches an exact year match iso_year Searches an exact ISO 8601 year match month Searches an exact month match day Searches an exact day match week Searches an exact week match week_day Searches an exact day of the week match quarter Searches an exact quarter of the year match. Valid integer range: 1‚Äì4 time Casts the value as a time. For datetime field lookups hour Searches an exact hour match minute Searches an exact minute match second Searches an exact second match isnull Search if field is null. Takes True or False regex/iregex Regular expression match. iregex is case-insensitive version Aggregate Functions: Django includes seven aggregate functions:\nAvg. Returns the mean value of the expression Count. Count the number of returned objects Max. Returns the maximum value of the expression Min. Returns the minimum value of the expression StdDev. Returns the population standard deviation of the data in the expression Sum. Returns the sum of all values in the expression Variance. Returns the population variance of the data in the expression They are translated to the equivalent SQL by Django‚Äôs ORM.\nAggregate functions can either be used directly:\n\u003e\u003e\u003e from events.models import Event \u003e\u003e\u003e Event.objects.count() 4 Or with the aggregate() function:\n\u003e\u003e\u003e from django.db.models import Count \u003e\u003e\u003e Event.objects.aggregate(Count('id')) {'id__count': 4} \u003e\u003e\u003e \u003e\u003e\u003e from django.db.models import Avg, Max, Min, Sum, Count \u003e\u003e\u003e User.objects.all().aggregate(Avg('id')) {'id__avg': 7.571428571428571} \u003e\u003e\u003e User.objects.all().aggregate(Max('id')) {'id__max': 15} \u003e\u003e\u003e User.objects.all().aggregate(Min('id')) {'id__min': 1} \u003e\u003e\u003e User.objects.all().aggregate(Sum('id')) {'id__sum': 106} More Complex Queries Query Expressions Query expressions describe a computation or value used as a part of another query. There are six built-in query expressions:\nF()‚ÄîRepresents the value of a model field or annotated column Func()‚ÄîBase type for database functions like LOWER and SUM Aggregate()‚ÄîAll aggregate functions inherit from Aggregate() Value()‚ÄîExpression value. Not used directly ExpressionWrapper()‚ÄîUsed to wrap expressions of different types SubQuery()‚ÄîAdd a subquery to a QuerySet Django supports multiple arithmetic operators with query expressions, including:\nAddition and subtraction Multiplication and division Negation Modulo arithmetic; and The power operator We have already covered aggregation in this chapter, so let‚Äôs have a quick look at the other two commonly used query expressions: F() and Func().\nF() Expressions: The two primary uses for F() expressions is to move computational arithmetic from Python to the database and to reference other fields in the model.\nLet‚Äôs start with a simple example, say we want to delay the first event in the event calendar by two weeks. A conventional approach would look like this:\n\u003e\u003e\u003e from events.models import Event \u003e\u003e\u003e import datetime \u003e\u003e\u003e e = Event.objects.get(id=1) \u003e\u003e\u003e e.event_date += datetime.timedelta(days=14) \u003e\u003e\u003e e.save() In this example, Django retrieves the information from the database into memory, uses Python to perform the computation‚Äîin this case, add 14 days to the event date‚Äîand then saves the record back to the database.\nFor this example, the overhead for using Python to perform the date arithmetic is not onerous, however for more complex queries there is a definite advantage to moving the computational load to the database.\nNow let‚Äôs see how we accomplish the same task with an F() expression:\n\u003e\u003e\u003e from django.db.models import F \u003e\u003e\u003e e = Event.objects.get(id=1) \u003e\u003e\u003e e.event_date = F('event_date') + datetime.timedelta(days=14) \u003e\u003e\u003e e.save() In terms of the amount of code necessary to complete the task, we haven‚Äôt saved anything, however, by using the F() expression, Django will now create an SQL query that performs the computational logic inside the database, rather than in memory with Python.\nWhile this takes a huge load off the Django application in the case of executing complex computations, there is one drawback‚Äîbecause the calculations take place inside the database, Django is now out of sync with the updated state of the database. We can test this by looking at the Event object instance:\n\u003e\u003e\u003e e.event_date \u003cCombinedExpression: F(event_date) + DurationValue(14 days, 0:00:00)\u003e To retrieve the updated object from the database, we need to use the refresh_from_db() function:\n\u003e\u003e\u003e e.refresh_from_db() \u003e\u003e\u003e e.event_date datetime.datetime(2019, 9, 8, 22, 42, 15, tzinfo=datetime.timezone(datetime.timedelta(0), '+0000')) The second use for F() expressions‚Äîreferencing other model fields‚Äîis straight forward. For example, you can check for users with the same first and last name:\n\u003e\u003e\u003e MyclubUser.objects.filter(first_name=F('last_name')) \u003cQuerySet [\u003cMyclubUser: Don Don\u003e]\u003e This simple syntax works with all of Django‚Äôs field lookups and aggregate functions.\nFunc() Expressions Func() expressions can be used to represent any function supported by the underlying database (e.g. LOWER, UPPER, LEN, TRIM, CONCAT, etc.). For example:\n\u003e\u003e\u003e from events.models import MyclubUser \u003e\u003e\u003e from django.db.models import F, Func \u003e\u003e\u003e qry = usrs.annotate(f_upper=Func(F('last_name'), function='UPPER')) \u003e\u003e\u003e for usr in qry: ... print(usr.first_name, usr.f_upper) ... Joe SMYTHE Jane DOE John JONES Sally JONES Sally-Anne JONES Sarah JONES Mary JONES Jane SMYTHE Steve SMITH Don DON \u003e\u003e\u003e Notice how we are using F() expressions again to reference another field in the MyclubUser model.\nQ() Objects: Like F() expressions, a Q() object encapsulates an SQL expression inside a Python object. Q() objects are most often used to construct complex database queries by chaining together multiple expressions using AND (\u0026) and OR (|) operators:\n\u003e\u003e\u003e from events.models import MyclubUser \u003e\u003e\u003e from django.db.models import Q \u003e\u003e\u003e Q1 = Q(first_name__startswith='J') \u003e\u003e\u003e Q2 = Q(first_name__endswith='e') \u003e\u003e\u003e MyclubUser.objects.filter(Q1 \u0026 Q2) \u003cQuerySet [\u003cMyclubUser: Joe Smythe\u003e, \u003cMyclubUser: Jane Doe\u003e, \u003cMyclubUser: Jane Smythe\u003e]\u003e \u003e\u003e\u003e MyclubUser.objects.filter(Q1 | Q2) \u003cQuerySet [\u003cMyclubUser: Joe Smythe\u003e, \u003cMyclubUser: Jane Doe\u003e, \u003cMyclubUser: John Jones\u003e, \u003cMyclubUser: Sally-Anne Jones\u003e, \u003cMyclubUser: Jane Smythe\u003e, \u003cMyclubUser: Steve Smith\u003e]\u003e \u003e\u003e\u003e You can also perform NOT queries using the negate (~) character:\n\u003e\u003e\u003e MyclubUser.objects.filter(~Q2) \u003cQuerySet [\u003cMyclubUser: John Jones\u003e, \u003cMyclubUser: Sally Jones\u003e, \u003cMyclubUser: Sarah Jones\u003e, \u003cMyclubUser: Mary Jones\u003e, \u003cMyclubUser: Don Don\u003e]\u003e \u003e\u003e\u003e MyclubUser.objects.filter(Q1 \u0026 ~Q2) \u003cQuerySet [\u003cMyclubUser: John Jones\u003e]\u003e Model Managers: A Manager is a Django class that provides the interface between database query operations and a Django model. Each Django model is provided with a default Manager named objects. We have been using the default manager every time we query the database, for example:\n\u003e\u003e\u003e newevent = Event.objects.get(name=\"Xmas Barbeque\") \u003e\u003e\u003e joneses = MyclubUser.objects.filter(last_name='Jones') In each example, objects is the default Manager for the model instance.\nYou can customize the default Manager class, by extending the base Manager class for the model. The two most common use-cases for customizing the default manager are:\nAdding extra manager methods; and Modifying initial QuerySet results. Adding Extra Manager Methods: Extra manager methods add table-level functionality to models. To add row-level functions, i.e. methods that act on single instances of the model, you use model methods, which we cover in the next section of the chapter.\nExtra manager methods are created by inheriting the Manager base class and adding custom functions to the custom Manager class. For example, let‚Äôs create an extra manager method for the Event model that retrieves the total number of events for a particular type of event (e.g. gala day or presentation):\n# myclub_rooteventsmodels.py from django.db import models from django.contrib.auth.models import User # ... 1 class EventManager(models.Manager): 2 def event_type_count(self, event_type): 3 return self.filter(name__icontains=event_type).count() 4 5 6 class Event(models.Model): 7 name = models.CharField('Event Name', max_length=120) 8 event_date = models.DateTimeField('Event Date') 9 venue = models.ForeignKey(Venue, on_delete=models.CASCADE) 10 manager = models.ForeignKey(User, blank=True, null=True, on_delete=models.SET_NULL) 11 attendees = models.ManyToManyField(MyclubUser) 12 description = models.TextField(blank=True) 13 objects = EventManager() 14 15 def __str__(self): 16 return self.name In Line 1, we‚Äôve entered a new class called EventManager that inherits from Django‚Äôs models.Manager base class. Lines 2 and 3 is the extra Manager method we‚Äôre adding to the model. This new method returns the total number of the specified event type. Note we‚Äôre using the icontains field lookup to return all events that have the key phrase in the title. In Line 13 we‚Äôre replacing the default manager with our new EventManager class. Note that EventManager inherits from the Manager base class, so all the default manager methods like all() and filter() are automatically included in the custom EventManager() class. Once it has been created, you can use your new manager method just like any other model menthod:\n\u003e\u003e\u003e from events.models import Event \u003e\u003e\u003e Event.objects.event_type_count('Gala Day') 1 \u003e\u003e\u003e Event.objects.event_type_count('Presentation') 2 Renaming the Default Model Manager While the base manager for each model is named objects by default, you can change the name of the default manager in your class declaration. For example, to change the default manager name for our Event class from objects to events, we just need to change line 13 in the code above from:\n13 objects = EventManager() To:\n13 events = EventManager() Now you can refer to the default manager like so:\n\u003e\u003e\u003e from events.models import Event \u003e\u003e\u003e Event.events.all() \u003cQuerySet [\u003cEvent: Test Event\u003e, \u003cEvent: Club Presentation - Juniors\u003e, \u003cEvent: Club Presentation - Seniors\u003e, \u003cEvent: Gala Day\u003e]\u003e \u003e\u003e\u003e Overriding Initial Manager QuerySets To modify what is returned by the default manager QuerySet, you override the Manager.get_queryset() method. This is easiest to understand with an example. Let‚Äôs say we commonly have to check what venues are listed in our local city. To cut down on the number of queries we have to write, we‚Äôre going to create a custom manager for our Venue model (changes in bold):\n# myclub_rooteventsmodels.py 1 from django.db import models 2 from django.contrib.auth.models import User 3 4 5 class VenueManager(models.Manager): 6 def get_queryset(self): 7 return super(VenueManager, self).get_queryset().filter(zip_code='00000') 8 9 10 class Venue(models.Model): 11 name = models.CharField('Venue Name', max_length=120) 12 address = models.CharField(max_length=300) 13 zip_code = models.CharField('Zip/Post Code', max_length=12) 14 phone = models.CharField('Contact Phone', max_length=20, blank=True) 15 web = models.URLField('Web Address', blank=True) 16 email_address = models.EmailField('Email Address',blank=True) 17 18 venues = models.Manager() 19 local_venues = VenueManager() 20 21 def __str__(self): 22 return self.name # ... Let‚Äôs take a look at the changes:\nLines 5 to 7 is the new VenueManager class. The structure is the same as the EventManager class, except this time we‚Äôre overriding the default get_queryset() method and returning a filtered list that only contains local venues. In Line 18 I have renamed the default manager to venues In Line 19 we‚Äôre adding the custom model manager (VenueManager) Note that there is no limit to how many custom managers you can add to a Django model instance. This makes creating custom filters for commonly used queries a breeze. Once you have save the models.py file, you can use the custom methods in your code. For example, the default manager method has been renamed, so you can use the more intuitive venues, instead of objects:\n\u003e\u003e\u003e Venue.venues.all() \u003cQuerySet [\u003cVenue: South Stadium\u003e, \u003cVenue: West Park\u003e, \u003cVenue: North Stadium\u003e, \u003cVenue: East Park\u003e]\u003e And our new custom manager is also easily accessible:\n\u003e\u003e\u003e from events.models import Venue \u003e\u003e\u003e Venue.local_venues.all() \u003cQuerySet [\u003cVenue: West Park\u003e]\u003e \u003e\u003e\u003e Model Methods Django‚Äôs Model class comes with many built-in methods. We have already used many of them - save(), delete(), __str__() and others. Where manager methods add table-level functionality to Django‚Äôs models, model methods add row-level functions that act on individual instances of the model.\nThere are two common cases where you want to play with model methods:\nWhen you want to add business logic to the model by adding custom model methods; and When you want to override the default behavior of a built-in model method. Custom Model Methods As always, it‚Äôs far easier to understand how custom model methods work by writing a couple, so let‚Äôs go ahead and modify our Event class (changes in bold):\n# myclub_rooteventsmodels.py # ... 1 class Event(models.Model): 2 name = models.CharField('Event Name', max_length=120) 3 event_date = models.DateTimeField('Event Date') 4 venue = models.ForeignKey(Venue, on_delete=models.CASCADE) 5 manager = models.ForeignKey(User, blank=True, null=True, on_delete=models.SET_NULL) 6 attendees = models.ManyToManyField(MyclubUser) 7 description = models.TextField(blank=True) 8 events = EventManager() 9 10 def event_timing(self, date): 11 if self.event_date \u003e date: 12 return \"Event is after this date\" 13 elif self.event_date == date: 14 return \"Event is on the same day\" 15 else: 16 return \"Event is befor this date\" 17 18 @property 19 def name_slug(self): 20 return self.name.lower().replace(' ','-') 21 22 def __str__(self): 23 return self.name Let‚Äôs have a look at what‚Äôs happening with this new code:\nIn Line 10 I have added a new method called event_timing. This is a straight forward method that compares the event date to the date passed to the method and returns a message stating whether the event occurs before, on or after the date. In Line 19 I have added another custom method that returns a slugified event name. The @property decorator on Line 18 allows us to access the method directly, like an attribute. Without the @property, you would have to use a method call (name_slug()). Let‚Äôs test these new methods out in the Django interactive interpreter. Don‚Äôt forget to save the model before you start!\nFirst, the name_slug method:\n\u003e\u003e\u003e from events.models import Event \u003e\u003e\u003e events = Event.events.all() \u003e\u003e\u003e for event in events: ... print(event.name_slug) ... test-event club-presentation---juniors club-presentation---seniors gala-day This should be easy to follow. Notice how the @property decorator allows us to access the method directly like it was an attribute. I.e. event.name_slug instead of event.name_slug().\nNow to test the event_timing method:\n\u003e\u003e\u003e from datetime import datetime, timezone \u003e\u003e\u003e e = Event.events.get(name=\"Gala Day\") \u003e\u003e\u003e e.event_timing(datetime.now(timezone.utc)) 'Event is befor this date' \u003e\u003e\u003e Too easy.\nDate and Time in Django\nSomething to note when working with dates in Django. Django uses timezone aware dates, so if you are doing date comparisons like the in any of your code, not just in class methods, you can‚Äôt use datetime.now() as Django will throw a TypeError: can't compare offset-naive and offset-aware datetimes. To avoid this error, you must provide timezone information with your dates.\nOverriding Default Model Methods It‚Äôs common to want to override built-in model methods like save() and delete() to add business logic to default database behavior.\nTo override a built-in model method you define a new method with the same name. For, example, let‚Äôs override the Event model‚Äôs default save() method to automatically assign management of the event to a staff member (changes in bold):\n# myclub_rooteventsmodels.py # ... 1 class Event(models.Model): 2 name = models.CharField('Event Name', max_length=120) 3 event_date = models.DateTimeField('Event Date') 4 venue = models.ForeignKey(Venue, on_delete=models.CASCADE) 5 manager = models.ForeignKey(User, blank=True, null=True, on_delete=models.SET_NULL) 6 attendees = models.ManyToManyField(MyclubUser) 7 description = models.TextField(blank=True) 8 events = EventManager() 9 10 def save(self, *args, **kwargs): 11 self.manager = User.objects.get(username='abbyb') 12 super(Event, self).save(*args, **kwargs) # ... The new save() method starts on Line 10. In the overridden save() method, we‚Äôre first assigning the staff member with the username ‚Äúabbyb‚Äù to the manager field of the model instance (Line 11), and then we call the default save() method with the super() function to save the model instance to the database (Line 12).\nOnce you save your models.py file, you can test out the overridden model method in the Django interactive shell:\n\u003e\u003e\u003e from events.models import Event \u003e\u003e\u003e from events.models import Venue \u003e\u003e\u003e from datetime import datetime, timezone \u003e\u003e\u003e v = Venue.venues.get(id=1) \u003e\u003e\u003e e = Event.events.create(name='New Event', event_date=datetime.now(timezone.utc), venue=v) Once the new record has been created, you can test to see if your override worked by checking the manager field of the Event object:\n\u003e\u003e\u003e e.manager \u003cUser: abbyb\u003e \u003e\u003e\u003e Model Inheritance Models are simply Python classes, so inheritance works the same way as normal Python class inheritance. The two most common forms of model inheritance in Django are:\nMulti-table inheritance, where each model has its own database table; and Abstract base classes, where the parent model holds information common to all its child classes, but doesn‚Äôt have a database table. You can also create proxy models that modify the Python-level behavior of a model without modifying the underlying model fields, however, we won‚Äôt be covering them here. See the Django documentation for more information on proxy models.\nMulti-table Inheritance Multi-table inheritance is straight forward‚Äîthe parent class is a normal model and the child inherits the parent by declaring the parent class in the child class declaration. For example:\nclass MyclubUser(models.Model): first_name = models.CharField(max_length=30) last_name = models.CharField(max_length=30) email = models.EmailField('User Email') def __str__(self): return self.first_name + \" \" + self.last_name class Subscriber(MyclubUser): date_joined = models.DateTimeField() The parent model in the example is the MyclubUser model from our events app. The Subscriber model inherits from MyclubUser and adds an additional field (date_joined). As they are both standard Django model classes, a database table will be created for each model.\nAbstract Base Classes Abstract base classes are handy when you want to put common information into other models without having to create a database table for the base class.\nYou create an abstract base class by adding the abstract = True class Meta option (Line 7 in this example):\n1 class UserBase(models.Model): 2 first_name = models.CharField(max_length=30) 3 last_name = models.CharField(max_length=30) 4 email = models.EmailField('User Email') 5 6 class Meta: 7 abstract = True 8 ordering = ['last_name'] 9 10 11 class MyclubUser(UserBase): 12 def __str__(self): 13 return self.first_name + \" \" + self.last_name 14 15 16 class Subscriber(UserBase): 17 date_joined = models.DateTimeField() Abstract base classes are also useful for declaring class Meta options that are inherited by all child models (Line 8).\nAs the MyclubUser model from our events app now inherits the first name, last name and email fields from UserBase, it only needs to declare the __str__() function to behave the same way as the original MyclubUser model we created earlier.\nThis example is very similar to the example for multi-table inheritance in the previous section, and if you saved and migrated these models, you would get exactly the same result as the above code ‚ÄîDjango would create the events_myclubuser and events_subscriber tables in your database, however, because UserBase is and abstract model, it won‚Äôt be added to the database as a table.\nReferences: https://raturi.in/blog/everything-about-django-orm-querysets-field-lookups-model-managers-aggregate-functions-tutorial/ https://www.youtube.com/playlist?list=PLOLrQ9Pn6cazjoDEnwzcdWWf4SNS0QZml ","wordCount":"5412","inLanguage":"en","image":"https://abotyim.github.io/posts/python/django-orm.jpg","datePublished":"2021-10-21T00:00:00Z","dateModified":"2021-10-21T00:00:00Z","author":[{"@type":"Person","name":"AboTyim"}],"mainEntityOfPage":{"@type":"WebPage","@id":"https://abotyim.github.io/en/posts/django/orm/"},"publisher":{"@type":"Organization","name":"Abo Tyim","logo":{"@type":"ImageObject","url":"https://abotyim.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://abotyim.github.io/en/ accesskey=h title="Abo Tyim (Alt + H)"><img src=https://abotyim.github.io/icon.jpg alt=logo aria-label=logo height=35>Abo Tyim</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://abotyim.github.io/ar/ title=AR aria-label=AR>AR</a></li></ul></span></div><ul id=menu><li><a href=https://abotyim.github.io/en/categories/ title="Categories üìö"><span>Categories üìö</span></a></li><li><a href=https://abotyim.github.io/en/tags/ title="Tags üè∑Ô∏è"><span>Tags üè∑Ô∏è</span></a></li><li><a href=https://abotyim.github.io/en/series/ title="Series üßµ"><span>Series üßµ</span></a></li><li><a href=https://abotyim.github.io/en/archives/ title="Archive üóÑÔ∏è"><span>Archive üóÑÔ∏è</span></a></li><li><a href=https://abotyim.github.io/en/search/ title="Search üîç"><span>Search üîç</span></a></li><li><a href=https://abotyim.github.io/en/about/ title="About üë®‚Äçüíª"><span>About üë®‚Äçüíª</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://abotyim.github.io/en/>Home</a></div><h1 class=post-title>Django ORM</h1><div class=post-description>Django ORM ‚Äî Object Relation Mapper is a powerful and elegant way to interact with the database. The Django ORM is an abstraction layer that allows us to play with the database.</div><div class=post-meta><span title='2021-10-21 00:00:00 +0000 UTC'>October 21, 2021</span>&nbsp;¬∑&nbsp;26 min&nbsp;¬∑&nbsp;AboTyim</div></header><figure class=entry-cover><a href=https://abotyim.github.io/posts/python/django-orm.jpg target=_blank rel="noopener noreferrer"><img loading=lazy src=https://abotyim.github.io/posts/python/django-orm.jpg alt="Django Framework ORM"></a><p>logo from channel very academy</p></figure><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#methods-that-return-querysets aria-label="Methods That Return QuerySets:">Methods That Return QuerySets:</a><ul><li><a href=#filter aria-label=filter()><code>filter()</code></a></li><li><a href=#exclude aria-label=exclude()><code>exclude()</code></a></li><li><a href=#order_by-and-reverse aria-label="order_by() and reverse()"><code>order_by()</code> and <code>reverse()</code></a></li><li><a href=#values-and-values_list aria-label="values() and values_list()"><code>values()</code> and <code>values_list()</code></a></li><li><a href=#dates-and-datetimes aria-label="dates() and datetimes()"><code>dates()</code> and <code>datetimes()</code></a></li><li><a href=#union aria-label=union()><code>union()</code></a></li><li><a href=#select_related-and-prefetch_related aria-label="select_related() and prefetch_related()"><code>select_related()</code> and <code>prefetch_related()</code></a></li><li><a href=#only aria-label=only()><code>only()</code></a></li><li><a href=#annotate aria-label=annotate()><code>annotate()</code></a></li><li><a href=#raw aria-label=raw()><code>raw()</code></a></li></ul></li><li><a href=#methods-that-dont-return-querysets aria-label="Methods That Don‚Äôt Return QuerySets:">Methods That Don‚Äôt Return QuerySets:</a><ul><li><a href=#get_or_create aria-label=get_or_create()><code>get_or_create()</code></a></li><li><a href=#update_or_create aria-label=update_or_create()><code>update_or_create()</code></a></li><li><a href=#bulk_create-and-bulk_update aria-label="bulk_create() and bulk_update()"><code>bulk_create()</code> and <code>bulk_update()</code></a></li><li><a href=#count aria-label=count()><code>count()</code></a></li><li><a href=#in_bulk aria-label=in_bulk()><code>in_bulk()</code></a></li><li><a href=#latest-and-earliest aria-label="latest() and earliest()"><code>latest()</code> and <code>earliest()</code></a></li><li><a href=#first-an-last aria-label="first() an last()"><code>first()</code> an <code>last()</code></a></li><li><a href=#aggregate aria-label=aggregate()><code>aggregate()</code></a></li><li><a href=#exists aria-label=exists()><code>exists()</code></a></li></ul></li><li><a href=#field-lookups aria-label="Field Lookups:">Field Lookups:</a></li><li><a href=#aggregate-functions aria-label="Aggregate Functions:">Aggregate Functions:</a></li><li><a href=#more-complex-queries aria-label="More Complex Queries">More Complex Queries</a><ul><li><a href=#query-expressions aria-label="Query Expressions"><strong>Query Expressions</strong></a></li><li><a href=#f-expressions aria-label="F() Expressions:"><code>F()</code> Expressions:</a></li><li><a href=#func-expressions aria-label="Func() Expressions"><code>Func()</code> Expressions</a></li><li><a href=#q-objects aria-label="Q() Objects:"><code>Q()</code> Objects:</a></li></ul></li><li><a href=#model-managers aria-label="Model Managers:">Model Managers:</a><ul><li><a href=#adding-extra-manager-methods aria-label="Adding Extra Manager Methods:">Adding Extra Manager Methods:</a></li><li><a href=#renaming-the-default-model-manager aria-label="Renaming the Default Model Manager">Renaming the Default Model Manager</a></li><li><a href=#overriding-initial-manager-querysets aria-label="Overriding Initial Manager QuerySets">Overriding Initial Manager QuerySets</a></li></ul></li><li><a href=#model-methods aria-label="Model Methods">Model Methods</a><ul><li><a href=#custom-model-methods aria-label="Custom Model Methods">Custom Model Methods</a></li><li><a href=#overriding-default-model-methods aria-label="Overriding Default Model Methods">Overriding Default Model Methods</a></li></ul></li><li><a href=#model-inheritance aria-label="Model Inheritance">Model Inheritance</a><ul><li><a href=#multi-table-inheritance aria-label="Multi-table Inheritance">Multi-table Inheritance</a></li><li><a href=#abstract-base-classes aria-label="Abstract Base Classes">Abstract Base Classes</a></li></ul></li><li><a href=#references aria-label=References:>References:</a></li></ul></div></details></div><div class=post-content><h2 id=methods-that-return-querysets>Methods That Return QuerySets:<a hidden class=anchor aria-hidden=true href=#methods-that-return-querysets>#</a></h2><table><thead><tr><th><strong>Method</strong></th><th><strong>Description</strong></th></tr></thead><tbody><tr><td><strong><code>filter()</code></strong></td><td>Filter by the given lookup parameters. Multiple parameters are joined by SQL <code>AND</code> statements</td></tr><tr><td><strong><code>exclude()</code></strong></td><td>Filter by objects that don‚Äôt match the given lookup parameters</td></tr><tr><td><strong><code>order_by()</code></strong></td><td>Change the default ordering of the QuerySet</td></tr><tr><td><strong><code>reverse()</code></strong></td><td>Reverse the default ordering of the QuerySet</td></tr><tr><td><strong><code>distinct()</code></strong></td><td>Perform an <strong>SQL <code>SELECT DISTINCT</code></strong> query to eliminate duplicate rows</td></tr><tr><td><strong><code>values()</code></strong></td><td>Returns dictionaries instead of model instances</td></tr><tr><td><strong><code>values_list()</code></strong></td><td>Returns tuples instead of model instances</td></tr><tr><td><strong><code>dates()</code></strong></td><td>Returns a QuerySet containing all available dates in the specified date range</td></tr><tr><td><strong><code>datetimes()</code></strong></td><td>Returns a QuerySet containing all available dates in the specified date and time range</td></tr><tr><td><strong><code>none()</code></strong></td><td>Create an empty QuerySet</td></tr><tr><td><strong><code>all()</code></strong></td><td>Return a copy of the current QuerySet</td></tr><tr><td><strong><code>union()</code></strong></td><td>Use the <strong>SQL <code>UNION</code></strong> operator to combine two or more QuerySets</td></tr><tr><td><strong><code>intersection()</code></strong></td><td>Use the <strong>SQL <code>INTERSECT</code></strong> operator to return the shared elements of two or more QuerySets</td></tr><tr><td><strong><code>difference()</code></strong></td><td>Use the <strong>SQL <code>EXCEPT</code></strong> operator to return elements in the first QuerySet that are not in the others</td></tr><tr><td><strong><code>select_related()</code></strong></td><td>Select all related data when executing the query (except many-to-many relationships)</td></tr><tr><td><strong><code>prefetch_related()</code></strong></td><td>Select all related data when executing the query (including many-to-many relationships)</td></tr><tr><td><strong><code>defer()</code></strong></td><td>Do not retrieve the names fields from the database. Used to improve query performance on complex datasets</td></tr><tr><td><strong><code>only()</code></strong></td><td>Opposite of **<code>defer() : </code>**return only the name fields</td></tr><tr><td><strong><code>using()</code></strong></td><td>Select which database the QuerySet will be evaluated against (when using multiple databases)</td></tr><tr><td><strong><code>select_for_update()</code></strong></td><td>Return a QuerySet that will lock rows until the end of the transaction</td></tr><tr><td><strong><code>raw()</code></strong></td><td>Execute a raw SQL statement</td></tr><tr><td><strong><code>AND (&)</code></strong></td><td>Combine two QuerySets with the SQL <code>AND</code> operator. Using <strong><code>AND (&)</code></strong> is functionally equivalent to using <strong><code>filter()</code></strong> with multiple parameters</td></tr><tr><td><strong><code>OR</code> (|)</strong></td><td>Combine two QuerySets with the <strong>SQL <code>OR</code></strong> operator</td></tr><tr><td><strong><code>annotate()</code></strong></td><td>Annotate each object in the QuerySet. Annotations can be simple values, a field reference or an aggregate expression</td></tr></tbody></table><p>Let‚Äôs go ahead and use the Django interactive shell to explore a few examples of the more common QuerySet methods.</p><h3 id=filter><code>filter()</code><a hidden class=anchor aria-hidden=true href=#filter>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>queryset <span style=color:#ff79c6>=</span> User<span style=color:#ff79c6>.</span>objects<span style=color:#ff79c6>.</span>filter(first_name<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#39;Ahmed&#39;</span>)
</span></span><span style=display:flex><span>queryset
</span></span><span style=display:flex><span><span style=color:#ff79c6>&lt;</span>QuerySet [<span style=color:#ff79c6>&lt;</span>User: Ahmed<span style=color:#ff79c6>&gt;</span>, <span style=color:#ff79c6>&lt;</span>User: Ahmed<span style=color:#ff79c6>&gt;</span>, <span style=color:#ff79c6>&lt;</span>User: Ahmed<span style=color:#ff79c6>&gt;</span>]<span style=color:#ff79c6>&gt;</span>
</span></span></code></pre></div><h3 id=exclude><code>exclude()</code><a hidden class=anchor aria-hidden=true href=#exclude>#</a></h3><p>return a QuerySet of objects that don‚Äôt match the given lookup parameters, for example:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> <span style=color:#ff79c6>from</span> events.models <span style=color:#ff79c6>import</span> Venue
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> Venue<span style=color:#ff79c6>.</span>objects<span style=color:#ff79c6>.</span>exclude(name<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;South Stadium&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#ff79c6>&lt;</span>QuerySet [<span style=color:#ff79c6>&lt;</span>Venue: West Park<span style=color:#ff79c6>&gt;</span>, <span style=color:#ff79c6>&lt;</span>Venue: North Stadium<span style=color:#ff79c6>&gt;</span>, <span style=color:#ff79c6>&lt;</span>Venue: East Park<span style=color:#ff79c6>&gt;</span>]<span style=color:#ff79c6>&gt;</span>
</span></span></code></pre></div><p>Using more than one lookup parameter will use an SQL <code>AND</code> operator under the hood:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> <span style=color:#ff79c6>from</span> events.models <span style=color:#ff79c6>import</span> Event
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> <span style=color:#ff79c6>import</span> datetime
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> venue1 <span style=color:#ff79c6>=</span> Venue<span style=color:#ff79c6>.</span>objects<span style=color:#ff79c6>.</span>get(name<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;East Park&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> Event<span style=color:#ff79c6>.</span>objects<span style=color:#ff79c6>.</span>exclude(venue<span style=color:#ff79c6>=</span>venue1,event_date<span style=color:#ff79c6>=</span>datetime<span style=color:#ff79c6>.</span>date(<span style=color:#bd93f9>2019</span>,<span style=color:#bd93f9>10</span>,<span style=color:#bd93f9>8</span>))
</span></span><span style=display:flex><span><span style=color:#ff79c6>&lt;</span>QuerySet [<span style=color:#ff79c6>&lt;</span>Event: Test Event<span style=color:#ff79c6>&gt;</span>, <span style=color:#ff79c6>&lt;</span>Event: Club Presentation <span style=color:#ff79c6>-</span> Juniors<span style=color:#ff79c6>&gt;</span>, <span style=color:#ff79c6>&lt;</span>Event: Club Presentation <span style=color:#ff79c6>-</span> Seniors<span style=color:#ff79c6>&gt;</span>, <span style=color:#ff79c6>&lt;</span>Event: Gala Day<span style=color:#ff79c6>&gt;</span>]<span style=color:#ff79c6>&gt;</span>
</span></span></code></pre></div><h3 id=order_by-and-reverse><code>order_by()</code> and <code>reverse()</code><a hidden class=anchor aria-hidden=true href=#order_by-and-reverse>#</a></h3><p><strong><code>order_by()</code></strong> changes the default ordering of the QuerySet. Function parameters are the model fields to use to order the QuerySet. Ordering can be single level:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> <span style=color:#ff79c6>from</span> events.models <span style=color:#ff79c6>import</span> Event
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> Event<span style=color:#ff79c6>.</span>objects<span style=color:#ff79c6>.</span>all()<span style=color:#ff79c6>.</span>order_by(<span style=color:#f1fa8c>&#39;name&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#ff79c6>&lt;</span>QuerySet [<span style=color:#ff79c6>&lt;</span>Event: Club Presentation <span style=color:#ff79c6>-</span> Juniors<span style=color:#ff79c6>&gt;</span>, <span style=color:#ff79c6>&lt;</span>Event: Club Presentation <span style=color:#ff79c6>-</span> Seniors<span style=color:#ff79c6>&gt;</span>, <span style=color:#ff79c6>&lt;</span>Event: Gala Day<span style=color:#ff79c6>&gt;</span>, <span style=color:#ff79c6>&lt;</span>Event: Test Event<span style=color:#ff79c6>&gt;</span>]<span style=color:#ff79c6>&gt;</span>
</span></span></code></pre></div><p>Or ordering can be multi-level. In the following example, the events are first ordered by event date and then by event name:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> Event<span style=color:#ff79c6>.</span>objects<span style=color:#ff79c6>.</span>all()<span style=color:#ff79c6>.</span>order_by(<span style=color:#f1fa8c>&#39;event_date&#39;</span>,<span style=color:#f1fa8c>&#39;name&#39;</span>)  
</span></span><span style=display:flex><span><span style=color:#ff79c6>&lt;</span>QuerySet [<span style=color:#ff79c6>&lt;</span>Event: Club Presentation <span style=color:#ff79c6>-</span> Juniors<span style=color:#ff79c6>&gt;</span>, <span style=color:#ff79c6>&lt;</span>Event: Club Presentation <span style=color:#ff79c6>-</span> Seniors<span style=color:#ff79c6>&gt;</span>, <span style=color:#ff79c6>&lt;</span>Event: Gala Day<span style=color:#ff79c6>&gt;</span>, <span style=color:#ff79c6>&lt;</span>Event: Test Event<span style=color:#ff79c6>&gt;</span>]<span style=color:#ff79c6>&gt;</span>
</span></span></code></pre></div><p>By default, QuerySet fields are ordered in ascending order. To sort in descending order, use the negative sign**(<code>-</code>)**:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> Event<span style=color:#ff79c6>.</span>objects<span style=color:#ff79c6>.</span>all()<span style=color:#ff79c6>.</span>order_by(<span style=color:#f1fa8c>&#39;-name&#39;</span>) 
</span></span><span style=display:flex><span><span style=color:#ff79c6>&lt;</span>QuerySet [<span style=color:#ff79c6>&lt;</span>Event: Test Event<span style=color:#ff79c6>&gt;</span>, <span style=color:#ff79c6>&lt;</span>Event: Gala Day<span style=color:#ff79c6>&gt;</span>, <span style=color:#ff79c6>&lt;</span>Event: Club Presentation <span style=color:#ff79c6>-</span> Seniors<span style=color:#ff79c6>&gt;</span>, <span style=color:#ff79c6>&lt;</span>Event: Club Presentation <span style=color:#ff79c6>-</span> Juniors<span style=color:#ff79c6>&gt;</span>]<span style=color:#ff79c6>&gt;</span>
</span></span></code></pre></div><p><strong><code>reverse()</code></strong> reverses the default ordering of the QuerySet:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> Event<span style=color:#ff79c6>.</span>objects<span style=color:#ff79c6>.</span>all()<span style=color:#ff79c6>.</span>reverse()                     
</span></span><span style=display:flex><span><span style=color:#ff79c6>&lt;</span>QuerySet [<span style=color:#ff79c6>&lt;</span>Event: Test Event<span style=color:#ff79c6>&gt;</span>, <span style=color:#ff79c6>&lt;</span>Event: Club Presentation <span style=color:#ff79c6>-</span> Juniors<span style=color:#ff79c6>&gt;</span>, <span style=color:#ff79c6>&lt;</span>Event: Club Presentation <span style=color:#ff79c6>-</span> Seniors<span style=color:#ff79c6>&gt;</span>, <span style=color:#ff79c6>&lt;</span>Event: Gala Day<span style=color:#ff79c6>&gt;</span>]<span style=color:#ff79c6>&gt;</span>
</span></span></code></pre></div><p><strong>Note:</strong></p><ul><li>A model must have default ordering (by setting the <code>ordering</code> option of the models <code>Meta</code> class) for <code>reverse()</code> to be useful. If the model is unordered, the sort order of the returned QuerySet will be meaningless.</li><li>Both <code>order_by()</code> and <code>reverse()</code> are not free operations‚Äîthey come at a time cost to your database and should be used sparingly on large datasets.</li></ul><h3 id=values-and-values_list><code>values()</code> and <code>values_list()</code><a hidden class=anchor aria-hidden=true href=#values-and-values_list>#</a></h3><p><strong><code>values()</code></strong> returns Python <strong>dictionaries</strong>, instead of a <strong>QuerySet</strong> object:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> Event<span style=color:#ff79c6>.</span>objects<span style=color:#ff79c6>.</span>values()       
</span></span><span style=display:flex><span><span style=color:#ff79c6>&lt;</span>QuerySet [{<span style=color:#f1fa8c>&#39;id&#39;</span>: <span style=color:#bd93f9>1</span>, <span style=color:#f1fa8c>&#39;name&#39;</span>: <span style=color:#f1fa8c>&#39;Test Event&#39;</span>, <span style=color:#f1fa8c>&#39;event_date&#39;</span>: datetime<span style=color:#ff79c6>.</span>datetime(<span style=color:#bd93f9>2019</span>, <span style=color:#bd93f9>8</span>, <span style=color:#bd93f9>25</span>, <span style=color:#bd93f9>22</span>, <span style=color:#bd93f9>42</span>, <span style=color:#bd93f9>15</span>, tzinfo<span style=color:#ff79c6>=&lt;</span>UTC<span style=color:#ff79c6>&gt;</span>), <span style=color:#f1fa8c>&#39;venue_id&#39;</span>: <span style=color:#bd93f9>1</span>, <span style=color:#f1fa8c>&#39;manager_id&#39;</span>: <span style=color:#bd93f9>1</span>, <span style=color:#f1fa8c>&#39;description&#39;</span>: <span style=color:#f1fa8c>&#34;It&#39;s all happening here!&#34;</span>}, {<span style=color:#f1fa8c>&#39;id&#39;</span>: <span style=color:#bd93f9>2</span>, <span style=color:#f1fa8c>&#39;name&#39;</span>: <span style=color:#f1fa8c>&#39;Club Presentation - Juniors&#39;</span>, <span style=color:#f1fa8c>&#39;event_date&#39;</span>: datetime<span style=color:#ff79c6>.</span>datetime(<span style=color:#bd93f9>2019</span>, <span style=color:#bd93f9>8</span>, <span style=color:#bd93f9>1</span>, <span style=color:#bd93f9>12</span>, <span style=color:#bd93f9>0</span>, tzinfo<span style=color:#ff79c6>=&lt;</span>UTC<span style=color:#ff79c6>&gt;</span>), <span style=color:#f1fa8c>&#39;venue_id&#39;</span>: <span style=color:#bd93f9>4</span>, <span style=color:#f1fa8c>&#39;manager_id&#39;</span>: <span style=color:#bd93f9>2</span>, <span style=color:#f1fa8c>&#39;description&#39;</span>: <span style=color:#f1fa8c>&#39;&#39;</span>}]<span style=color:#ff79c6>&gt;</span>
</span></span></code></pre></div><p>You can also specify which fields you want returned:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> Event<span style=color:#ff79c6>.</span>objects<span style=color:#ff79c6>.</span>values(<span style=color:#f1fa8c>&#39;name&#39;</span>,<span style=color:#f1fa8c>&#39;description&#39;</span>) 
</span></span><span style=display:flex><span><span style=color:#ff79c6>&lt;</span>QuerySet [{<span style=color:#f1fa8c>&#39;name&#39;</span>: <span style=color:#f1fa8c>&#39;Test Event&#39;</span>, <span style=color:#f1fa8c>&#39;description&#39;</span>: <span style=color:#f1fa8c>&#34;It&#39;s all happening here!&#34;</span>}, {<span style=color:#f1fa8c>&#39;name&#39;</span>: <span style=color:#f1fa8c>&#39;Club Presentation - Juniors&#39;</span>, <span style=color:#f1fa8c>&#39;description&#39;</span>: <span style=color:#f1fa8c>&#39;&#39;</span>}]<span style=color:#ff79c6>&gt;</span>
</span></span></code></pre></div><p><strong><code>values_list()</code></strong> is the same as <strong><code>values()</code></strong>, except it returns <strong>tuples</strong>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> Event<span style=color:#ff79c6>.</span>objects<span style=color:#ff79c6>.</span>values_list() 
</span></span><span style=display:flex><span><span style=color:#ff79c6>&lt;</span>QuerySet [(<span style=color:#bd93f9>1</span>, <span style=color:#f1fa8c>&#39;Test Event&#39;</span>, datetime<span style=color:#ff79c6>.</span>datetime(<span style=color:#bd93f9>2019</span>, <span style=color:#bd93f9>8</span>, <span style=color:#bd93f9>25</span>, <span style=color:#bd93f9>22</span>, <span style=color:#bd93f9>42</span>, <span style=color:#bd93f9>15</span>, tzinfo<span style=color:#ff79c6>=&lt;</span>UTC<span style=color:#ff79c6>&gt;</span>), <span style=color:#bd93f9>1</span>, <span style=color:#bd93f9>1</span>, <span style=color:#f1fa8c>&#34;It&#39;s all happening here!&#34;</span>), (<span style=color:#bd93f9>2</span>, <span style=color:#f1fa8c>&#39;Club Presentation - Juniors&#39;</span>, datetime<span style=color:#ff79c6>.</span>datetime(<span style=color:#bd93f9>2019</span>, <span style=color:#bd93f9>8</span>, <span style=color:#bd93f9>1</span>, <span style=color:#bd93f9>12</span>, <span style=color:#bd93f9>0</span>, tzinfo<span style=color:#ff79c6>=&lt;</span>UTC<span style=color:#ff79c6>&gt;</span>), <span style=color:#bd93f9>4</span>, <span style=color:#bd93f9>2</span>, <span style=color:#f1fa8c>&#39;&#39;</span>)]<span style=color:#ff79c6>&gt;</span>
</span></span></code></pre></div><p>You can also specify which fields to return:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> Event<span style=color:#ff79c6>.</span>objects<span style=color:#ff79c6>.</span>values_list(<span style=color:#f1fa8c>&#39;name&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#ff79c6>&lt;</span>QuerySet [(<span style=color:#f1fa8c>&#39;Test Event&#39;</span>,), (<span style=color:#f1fa8c>&#39;Club Presentation - Juniors&#39;</span>,)]<span style=color:#ff79c6>&gt;</span>
</span></span></code></pre></div><h3 id=dates-and-datetimes><code>dates()</code> and <code>datetimes()</code><a hidden class=anchor aria-hidden=true href=#dates-and-datetimes>#</a></h3><p>You use the <strong><code>dates()</code></strong> and <strong><code>datetimes()</code></strong> methods to return time-bounded records from the database (for example, all the events occuring in a particular month). For <strong><code>dates()</code></strong>, these time bounds are <strong><code>year</code></strong>, <strong><code>month</code></strong>, <strong><code>week</code></strong> and <strong><code>day</code></strong>. <strong><code>datetimes()</code></strong> adds <strong><code>hour</code></strong>, <strong><code>minute</code></strong> and <strong><code>second</code></strong> bounds. Some examples:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> <span style=color:#ff79c6>from</span> events.models <span style=color:#ff79c6>import</span> Event
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> Event<span style=color:#ff79c6>.</span>objects<span style=color:#ff79c6>.</span>dates(<span style=color:#f1fa8c>&#39;event_date&#39;</span>, <span style=color:#f1fa8c>&#39;year&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#ff79c6>&lt;</span>QuerySet [datetime<span style=color:#ff79c6>.</span>date(<span style=color:#bd93f9>2019</span>, <span style=color:#bd93f9>1</span>, <span style=color:#bd93f9>1</span>)]<span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> Event<span style=color:#ff79c6>.</span>objects<span style=color:#ff79c6>.</span>dates(<span style=color:#f1fa8c>&#39;event_date&#39;</span>, <span style=color:#f1fa8c>&#39;month&#39;</span>) 
</span></span><span style=display:flex><span><span style=color:#ff79c6>&lt;</span>QuerySet [datetime<span style=color:#ff79c6>.</span>date(<span style=color:#bd93f9>2019</span>, <span style=color:#bd93f9>8</span>, <span style=color:#bd93f9>1</span>)]<span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> Event<span style=color:#ff79c6>.</span>objects<span style=color:#ff79c6>.</span>dates(<span style=color:#f1fa8c>&#39;event_date&#39;</span>, <span style=color:#f1fa8c>&#39;week&#39;</span>)  
</span></span><span style=display:flex><span><span style=color:#ff79c6>&lt;</span>QuerySet [datetime<span style=color:#ff79c6>.</span>date(<span style=color:#bd93f9>2019</span>, <span style=color:#bd93f9>7</span>, <span style=color:#bd93f9>29</span>), datetime<span style=color:#ff79c6>.</span>date(<span style=color:#bd93f9>2019</span>, <span style=color:#bd93f9>8</span>, <span style=color:#bd93f9>5</span>), datetime<span style=color:#ff79c6>.</span>date(<span style=color:#bd93f9>2019</span>, <span style=color:#bd93f9>8</span>, <span style=color:#bd93f9>19</span>)]<span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> Event<span style=color:#ff79c6>.</span>objects<span style=color:#ff79c6>.</span>dates(<span style=color:#f1fa8c>&#39;event_date&#39;</span>, <span style=color:#f1fa8c>&#39;day&#39;</span>)  
</span></span><span style=display:flex><span><span style=color:#ff79c6>&lt;</span>QuerySet [datetime<span style=color:#ff79c6>.</span>date(<span style=color:#bd93f9>2019</span>, <span style=color:#bd93f9>8</span>, <span style=color:#bd93f9>1</span>), datetime<span style=color:#ff79c6>.</span>date(<span style=color:#bd93f9>2019</span>, <span style=color:#bd93f9>8</span>, <span style=color:#bd93f9>10</span>), datetime<span style=color:#ff79c6>.</span>date(<span style=color:#bd93f9>2019</span>, <span style=color:#bd93f9>8</span>, <span style=color:#bd93f9>11</span>), datetime<span style=color:#ff79c6>.</span>date(<span style=color:#bd93f9>2019</span>, <span style=color:#bd93f9>8</span>, <span style=color:#bd93f9>25</span>)]<span style=color:#ff79c6>&gt;</span>
</span></span></code></pre></div><h3 id=union><code>union()</code><a hidden class=anchor aria-hidden=true href=#union>#</a></h3><p>The UNION operator is used to combine the result-set of two or more querysets. The querysets can be from the same or from different models. When they querysets are from different models, the fields and their datatypes should match.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> q1 <span style=color:#ff79c6>=</span> User<span style=color:#ff79c6>.</span>objects<span style=color:#ff79c6>.</span>filter(id__gte<span style=color:#ff79c6>=</span><span style=color:#bd93f9>5</span>)
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> q1
</span></span><span style=display:flex><span><span style=color:#ff79c6>&lt;</span>QuerySet [<span style=color:#ff79c6>&lt;</span>User: Ritesh<span style=color:#ff79c6>&gt;</span>, <span style=color:#ff79c6>&lt;</span>User: Billy<span style=color:#ff79c6>&gt;</span>, <span style=color:#ff79c6>&lt;</span>User: Radha<span style=color:#ff79c6>&gt;</span>, <span style=color:#ff79c6>&lt;</span>User: sohan<span style=color:#ff79c6>&gt;</span>, <span style=color:#ff79c6>&lt;</span>User: Raghu<span style=color:#ff79c6>&gt;</span>, <span style=color:#ff79c6>&lt;</span>User: rishab<span style=color:#ff79c6>&gt;</span>]<span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> q2 <span style=color:#ff79c6>=</span> User<span style=color:#ff79c6>.</span>objects<span style=color:#ff79c6>.</span>filter(id__lte<span style=color:#ff79c6>=</span><span style=color:#bd93f9>9</span>)
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> q2
</span></span><span style=display:flex><span><span style=color:#ff79c6>&lt;</span>QuerySet [<span style=color:#ff79c6>&lt;</span>User: yash<span style=color:#ff79c6>&gt;</span>, <span style=color:#ff79c6>&lt;</span>User: John<span style=color:#ff79c6>&gt;</span>, <span style=color:#ff79c6>&lt;</span>User: Ricky<span style=color:#ff79c6>&gt;</span>, <span style=color:#ff79c6>&lt;</span>User: sharukh<span style=color:#ff79c6>&gt;</span>, <span style=color:#ff79c6>&lt;</span>User: Ritesh<span style=color:#ff79c6>&gt;</span>, <span style=color:#ff79c6>&lt;</span>User: Billy<span style=color:#ff79c6>&gt;</span>, <span style=color:#ff79c6>&lt;</span>User: Radha<span style=color:#ff79c6>&gt;</span>, <span style=color:#ff79c6>&lt;</span>User: sohan<span style=color:#ff79c6>&gt;</span>, <span style=color:#ff79c6>&lt;</span>User: Raghu<span style=color:#ff79c6>&gt;</span>]<span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> q1<span style=color:#ff79c6>.</span>union(q2)
</span></span><span style=display:flex><span><span style=color:#ff79c6>&lt;</span>QuerySet [<span style=color:#ff79c6>&lt;</span>User: yash<span style=color:#ff79c6>&gt;</span>, <span style=color:#ff79c6>&lt;</span>User: John<span style=color:#ff79c6>&gt;</span>, <span style=color:#ff79c6>&lt;</span>User: Ricky<span style=color:#ff79c6>&gt;</span>, <span style=color:#ff79c6>&lt;</span>User: sharukh<span style=color:#ff79c6>&gt;</span>, <span style=color:#ff79c6>&lt;</span>User: Ritesh<span style=color:#ff79c6>&gt;</span>, <span style=color:#ff79c6>&lt;</span>User: Billy<span style=color:#ff79c6>&gt;</span>, <span style=color:#ff79c6>&lt;</span>User: Radha<span style=color:#ff79c6>&gt;</span>, <span style=color:#ff79c6>&lt;</span>User: sohan<span style=color:#ff79c6>&gt;</span>, <span style=color:#ff79c6>&lt;</span>User: Raghu<span style=color:#ff79c6>&gt;</span>, <span style=color:#ff79c6>&lt;</span>User: rishab<span style=color:#ff79c6>&gt;</span>]<span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> q2<span style=color:#ff79c6>.</span>union(q1)
</span></span><span style=display:flex><span><span style=color:#ff79c6>&lt;</span>QuerySet [<span style=color:#ff79c6>&lt;</span>User: yash<span style=color:#ff79c6>&gt;</span>, <span style=color:#ff79c6>&lt;</span>User: John<span style=color:#ff79c6>&gt;</span>, <span style=color:#ff79c6>&lt;</span>User: Ricky<span style=color:#ff79c6>&gt;</span>, <span style=color:#ff79c6>&lt;</span>User: sharukh<span style=color:#ff79c6>&gt;</span>, <span style=color:#ff79c6>&lt;</span>User: Ritesh<span style=color:#ff79c6>&gt;</span>, <span style=color:#ff79c6>&lt;</span>User: Billy<span style=color:#ff79c6>&gt;</span>, <span style=color:#ff79c6>&lt;</span>User: Radha<span style=color:#ff79c6>&gt;</span>, <span style=color:#ff79c6>&lt;</span>User: sohan<span style=color:#ff79c6>&gt;</span>, <span style=color:#ff79c6>&lt;</span>User: Raghu<span style=color:#ff79c6>&gt;</span>, <span style=color:#ff79c6>&lt;</span>User: rishab<span style=color:#ff79c6>&gt;</span>]<span style=color:#ff79c6>&gt;</span>
</span></span></code></pre></div><p>Since <code>Hero</code> and <code>Villain</code> both have the <code>name</code> and <code>gender</code>, we can use <code>values_list</code> to limit the selected fields then do a union.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>Hero<span style=color:#ff79c6>.</span>objects<span style=color:#ff79c6>.</span>all()<span style=color:#ff79c6>.</span>values_list(
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#34;name&#34;</span>, <span style=color:#f1fa8c>&#34;gender&#34;</span>
</span></span><span style=display:flex><span>)<span style=color:#ff79c6>.</span>union(
</span></span><span style=display:flex><span>Villain<span style=color:#ff79c6>.</span>objects<span style=color:#ff79c6>.</span>all()<span style=color:#ff79c6>.</span>values_list(
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#34;name&#34;</span>, <span style=color:#f1fa8c>&#34;gender&#34;</span>
</span></span><span style=display:flex><span>))
</span></span></code></pre></div><p>This would give you all <code>Hero</code> and <code>Villain</code> objects with their name and gender.</p><h3 id=select_related-and-prefetch_related><code>select_related()</code> and <code>prefetch_related()</code><a hidden class=anchor aria-hidden=true href=#select_related-and-prefetch_related>#</a></h3><p>Selecting related information can be a database-intensive operation as each foreign key relationship requires an additional database lookup. For example, each <code>Event</code> object in our database has a foreign key realtionship with the <code>Venue</code> table:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> event1 <span style=color:#ff79c6>=</span> Event<span style=color:#ff79c6>.</span>objects<span style=color:#ff79c6>.</span>get(<span style=color:#8be9fd;font-style:italic>id</span><span style=color:#ff79c6>=</span><span style=color:#bd93f9>1</span>)
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> event1<span style=color:#ff79c6>.</span>venue <span style=color:#6272a4># Foreign key retrieval causes additional database hit</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>&lt;</span>Venue: South Stadium<span style=color:#ff79c6>&gt;</span>
</span></span></code></pre></div><p>For our simple example, this is not a problem, but in large databases with many foreign key relationships, the load on the database can be prohibitive.</p><p>You use <strong><code>select_related()</code></strong> to improve database performance by retrieving all related data the first time the database is hit:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> event2 <span style=color:#ff79c6>=</span> Event<span style=color:#ff79c6>.</span>objects<span style=color:#ff79c6>.</span>select_related(<span style=color:#f1fa8c>&#39;venue&#39;</span>)<span style=color:#ff79c6>.</span>get(<span style=color:#8be9fd;font-style:italic>id</span><span style=color:#ff79c6>=</span><span style=color:#bd93f9>2</span>) 
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> event2<span style=color:#ff79c6>.</span>venue <span style=color:#6272a4># venue has already been retrieved. Database is not hit again.</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>&lt;</span>Venue: East Park<span style=color:#ff79c6>&gt;</span>
</span></span></code></pre></div><p><strong><code>prefetch_related()</code></strong> works the same way as <strong><code>select_related()</code></strong>, except it will work across many-to-many relationships.</p><h3 id=only><code>only()</code><a hidden class=anchor aria-hidden=true href=#only>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> queryset <span style=color:#ff79c6>=</span> User<span style=color:#ff79c6>.</span>objects<span style=color:#ff79c6>.</span>filter(
</span></span><span style=display:flex><span>    first_name__startswith<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#39;R&#39;</span>
</span></span><span style=display:flex><span>)<span style=color:#ff79c6>.</span>only(<span style=color:#f1fa8c>&#34;first_name&#34;</span>, <span style=color:#f1fa8c>&#34;last_name&#34;</span>)
</span></span></code></pre></div><p>The only difference between <code>only</code> and <code>values</code> is <code>only</code> also fetches the <code>id</code>.</p><h3 id=annotate><code>annotate()</code><a hidden class=anchor aria-hidden=true href=#annotate>#</a></h3><p>Annotations can be simple values, a field reference or an aggregate expression. For example, let‚Äôs use Django‚Äôs <code>Count</code> aggregate function to annotate our Event model with a total of all users attending each event:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> <span style=color:#ff79c6>from</span> events.models <span style=color:#ff79c6>import</span> Event
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> <span style=color:#ff79c6>from</span> django.db.models <span style=color:#ff79c6>import</span> Count
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> qry <span style=color:#ff79c6>=</span> Event<span style=color:#ff79c6>.</span>objects<span style=color:#ff79c6>.</span>annotate(total_attendees<span style=color:#ff79c6>=</span>Count(<span style=color:#f1fa8c>&#39;attendees&#39;</span>))
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> <span style=color:#ff79c6>for</span> event <span style=color:#ff79c6>in</span> qry:
</span></span><span style=display:flex><span><span style=color:#ff79c6>...</span>     <span style=color:#8be9fd;font-style:italic>print</span>(event<span style=color:#ff79c6>.</span>name, event<span style=color:#ff79c6>.</span>total_attendees) 
</span></span><span style=display:flex><span><span style=color:#ff79c6>...</span> 
</span></span><span style=display:flex><span>Test Event <span style=color:#bd93f9>0</span>
</span></span><span style=display:flex><span>Gala Day <span style=color:#bd93f9>2</span>
</span></span><span style=display:flex><span>Club Presentation <span style=color:#ff79c6>-</span> Juniors <span style=color:#bd93f9>5</span>
</span></span><span style=display:flex><span>Club Presentation <span style=color:#ff79c6>-</span> Seniors <span style=color:#bd93f9>3</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span>
</span></span></code></pre></div><h3 id=raw><code>raw()</code><a hidden class=anchor aria-hidden=true href=#raw>#</a></h3><p><strong>Executing Raw SQL</strong></p><p>While Django‚Äôs developers provide the <strong><code>raw()</code></strong> query method for executing raw SQL, you are explicitly discouraged from doing so.</p><p>The Django ORM is very powerful and in the vast majority of cases where I have seen programmers resort to SQL it has been due to an incomplete knowledge of Django‚Äôs ORM on the programmers part, not a deficiency in the ORM.</p><p>If you find yourself in the situation where a query is so complex you can‚Äôt find a way of completing the task with Django‚Äôs ORM, it‚Äôs likely you need to create a stored procedure or a new view within the database itself.</p><h2 id=methods-that-dont-return-querysets>Methods That Don‚Äôt Return QuerySets:<a hidden class=anchor aria-hidden=true href=#methods-that-dont-return-querysets>#</a></h2><table><thead><tr><th>Method</th><th>Description</th></tr></thead><tbody><tr><td><strong><code>get()</code></strong></td><td>Returns a single object. Throws an error if lookup returns multiple objects</td></tr><tr><td><strong><code>create()</code></strong></td><td>Shortcut method to create and save an object in one step</td></tr><tr><td><strong><code>get_or_create()</code></strong></td><td>Returns a single object. If the object doesn‚Äôt exist, it creates one</td></tr><tr><td><strong><code>update_or_create()</code></strong></td><td>Updates a single object. If the object doesn‚Äôt exist, it creates one</td></tr><tr><td><strong><code>bulk_create()</code></strong></td><td>Insert a list of objects in the database</td></tr><tr><td><strong><code>bulk_update()</code></strong></td><td>Update given fields in the listed model instances</td></tr><tr><td><strong><code>count()</code></strong></td><td>Count the number of objects in the returned QuerySet. Returns an integer</td></tr><tr><td><strong><code>in_bulk()</code></strong></td><td>Return a QuerySet containing all objects with the listed IDs</td></tr><tr><td><strong><code>iterator()</code></strong></td><td>Evaluate a QuerySet and return an iterator over the results. Can improve performance and memory use for queries that return a large number of objects</td></tr><tr><td><strong><code>latest()</code></strong></td><td>Return the latest object in the database table based on the given field(s)</td></tr><tr><td><strong><code>earliest()</code></strong></td><td>Return the earliest object in the database table based on the given field(s)</td></tr><tr><td><strong><code>first()</code></strong></td><td>Return the first object matched by the QuerySet</td></tr><tr><td><strong><code>last()</code></strong></td><td>Return the last object matched by the QuerySet</td></tr><tr><td><strong><code>aggregate()</code></strong></td><td>Return a dictionary of aggregate values calculated over the QuerySet</td></tr><tr><td><strong><code>exists()</code></strong></td><td>Returns <code>True</code> if the QuerySet contains any results</td></tr><tr><td><strong><code>update()</code></strong></td><td>Performs an SQL <code>UPDATE</code> on the specified field(s)</td></tr><tr><td><strong><code>delete()</code></strong></td><td>Performs an SQL <code>DELETE</code> that deletes all rows in the QuerySet</td></tr><tr><td><strong><code>as_manager()</code></strong></td><td>Return a <code>Manager</code> class instance containing a copy of the QuerySet‚Äôs methods</td></tr><tr><td><strong><code>explain()</code></strong></td><td>Returns a string of the QuerySet‚Äôs execution plan. Used for analysing query performance</td></tr></tbody></table><p>Let‚Äôs return to the Django interactive shell to dig deeper into some common examples:</p><h3 id=get_or_create><code>get_or_create()</code><a hidden class=anchor aria-hidden=true href=#get_or_create>#</a></h3><p><strong><code>get_or_create()</code></strong> will attempt to retrieve a record matching the search fields. If a record doesn‚Äôt exist, it will create one. The return value will be a tuple‚Äîthe created or retrieved object and a boolean value that will be <code>True</code> if a new record was created:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> <span style=color:#ff79c6>from</span> events.models <span style=color:#ff79c6>import</span> MyclubUser 
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> usr, boolCreated <span style=color:#ff79c6>=</span> MyclubUser<span style=color:#ff79c6>.</span>objects<span style=color:#ff79c6>.</span>get_or_create(first_name<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#39;John&#39;</span>, last_name<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#39;Jones&#39;</span>, email<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#39;johnj@example.com&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> usr
</span></span><span style=display:flex><span><span style=color:#ff79c6>&lt;</span>MyclubUser: John Jones<span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> boolCreated
</span></span><span style=display:flex><span><span style=color:#ff79c6>True</span>
</span></span></code></pre></div><p>If we try and create the object a second time, it will retrieve the new record from the database instead.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> usr, boolCreated <span style=color:#ff79c6>=</span> MyclubUser<span style=color:#ff79c6>.</span>objects<span style=color:#ff79c6>.</span>get_or_create(first_name<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#39;John&#39;</span>, last_name<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#39;Jones&#39;</span>, email<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#39;johnj@example.com&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> usr
</span></span><span style=display:flex><span><span style=color:#ff79c6>&lt;</span>MyclubUser: John Jones<span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> boolCreated
</span></span><span style=display:flex><span><span style=color:#ff79c6>False</span>
</span></span></code></pre></div><h3 id=update_or_create><code>update_or_create()</code><a hidden class=anchor aria-hidden=true href=#update_or_create>#</a></h3><p><strong><code>update_or_create()</code></strong> works similar to <strong><code>get_or_create()</code></strong>, except you pass the search fields and a dictionary named <code>defaults</code> that contains the fields to update. If the object doesn‚Äôt exist, it will create a new record in the database:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> usr, boolCreated <span style=color:#ff79c6>=</span> MyclubUser<span style=color:#ff79c6>.</span>objects<span style=color:#ff79c6>.</span>update_or_create(first_name<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#39;Mary&#39;</span>, last_name<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#39;Jones&#39;</span>, defaults<span style=color:#ff79c6>=</span>{<span style=color:#f1fa8c>&#39;email&#39;</span>:<span style=color:#f1fa8c>&#39;maryj@example.com&#39;</span>}) 
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> usr
</span></span><span style=display:flex><span><span style=color:#ff79c6>&lt;</span>MyclubUser: Mary Jones<span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> boolCreated
</span></span><span style=display:flex><span><span style=color:#ff79c6>True</span>
</span></span></code></pre></div><p>If the record does exist, Django will update all fields listed in the <code>defaults</code> dictionary:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> usr, boolCreated <span style=color:#ff79c6>=</span> MyclubUser<span style=color:#ff79c6>.</span>objects<span style=color:#ff79c6>.</span>update_or_create(first_name<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#39;Mary&#39;</span>, last_name<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#39;Jones&#39;</span>, defaults<span style=color:#ff79c6>=</span>{<span style=color:#f1fa8c>&#39;email&#39;</span>:<span style=color:#f1fa8c>&#39;mary_j@example.com&#39;</span>})    
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> usr
</span></span><span style=display:flex><span><span style=color:#ff79c6>&lt;</span>MyclubUser: Mary Jones<span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> usr<span style=color:#ff79c6>.</span>email
</span></span><span style=display:flex><span><span style=color:#f1fa8c>&#39;mary_j@example.com&#39;</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> boolCreated
</span></span><span style=display:flex><span><span style=color:#ff79c6>False</span>
</span></span></code></pre></div><h3 id=bulk_create-and-bulk_update><code>bulk_create()</code> and <code>bulk_update()</code><a hidden class=anchor aria-hidden=true href=#bulk_create-and-bulk_update>#</a></h3><p>The <strong><code>bulk_create()</code></strong> saves time by inserting multiple objects into the database at once, most often in a single query. The function has on required parameter‚Äîa list of objects:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> usrs <span style=color:#ff79c6>=</span> MyclubUser<span style=color:#ff79c6>.</span>objects<span style=color:#ff79c6>.</span>bulk_create([
</span></span><span style=display:flex><span><span style=color:#ff79c6>...</span>     MyclubUser(first_name<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#39;Jane&#39;</span>, last_name<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#39;Smith&#39;</span>, email<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#39;janes@example.com&#39;</span>),
</span></span><span style=display:flex><span><span style=color:#ff79c6>...</span>     MyclubUser(first_name<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#39;Steve&#39;</span>, last_name<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#39;Smith&#39;</span>, email<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#39;steves@example.com&#39;</span>),
</span></span><span style=display:flex><span><span style=color:#ff79c6>...</span> ])
</span></span></code></pre></div><p><strong><code>bulk_update()</code></strong> on the other hand takes a list of model objects and updates individual fields on selected model instances. For example, let‚Äôs say the first two ‚ÄúSmiths‚Äù in the database were entered incorrectly. First, we retrieve all the ‚ÄúSmiths‚Äù:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> usrs <span style=color:#ff79c6>=</span> MyclubUser<span style=color:#ff79c6>.</span>objects<span style=color:#ff79c6>.</span>filter(last_name<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#39;Smith&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> usrs
</span></span><span style=display:flex><span><span style=color:#ff79c6>&lt;</span>QuerySet [<span style=color:#ff79c6>&lt;</span>MyclubUser: Joe Smith<span style=color:#ff79c6>&gt;</span>, <span style=color:#ff79c6>&lt;</span>MyclubUser: Jane Smith<span style=color:#ff79c6>&gt;</span>, <span style=color:#ff79c6>&lt;</span>MyclubUser: Steve Smith<span style=color:#ff79c6>&gt;</span>]<span style=color:#ff79c6>&gt;</span>
</span></span></code></pre></div><p>We can then modify the <strong><code>last_name</code></strong> field on the first two instances and use the <strong><code>bulk_update</code></strong> function to save the changes to the database in a single query:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> usrs[<span style=color:#bd93f9>0</span>]<span style=color:#ff79c6>.</span>last_name <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;Smythe&#39;</span> 
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> usrs[<span style=color:#bd93f9>1</span>]<span style=color:#ff79c6>.</span>last_name <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;Smythe&#39;</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> MyclubUser<span style=color:#ff79c6>.</span>objects<span style=color:#ff79c6>.</span>bulk_update(usrs, [<span style=color:#f1fa8c>&#39;last_name&#39;</span>])
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> usrs
</span></span><span style=display:flex><span><span style=color:#ff79c6>&lt;</span>QuerySet [<span style=color:#ff79c6>&lt;</span>MyclubUser: Joe Smythe<span style=color:#ff79c6>&gt;</span>, <span style=color:#ff79c6>&lt;</span>MyclubUser: Jane Smythe<span style=color:#ff79c6>&gt;</span>, <span style=color:#ff79c6>&lt;</span>MyclubUser: Steve Smith<span style=color:#ff79c6>&gt;</span>]<span style=color:#ff79c6>&gt;</span>
</span></span></code></pre></div><h3 id=count><code>count()</code><a hidden class=anchor aria-hidden=true href=#count>#</a></h3><p>Count the number of objects in the QuerySet. Can be used to count all the objects in a database table:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> MyclubUser<span style=color:#ff79c6>.</span>objects<span style=color:#ff79c6>.</span>count()
</span></span><span style=display:flex><span><span style=color:#bd93f9>9</span>
</span></span></code></pre></div><p>Or used to count the number of objects returned by a query:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> MyclubUser<span style=color:#ff79c6>.</span>objects<span style=color:#ff79c6>.</span>filter(last_name<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#39;Smythe&#39;</span>)<span style=color:#ff79c6>.</span>count() 
</span></span><span style=display:flex><span><span style=color:#bd93f9>2</span>
</span></span></code></pre></div><p><strong><code>count()</code></strong> is functionally equivalent to using the <strong><code>aggregate()</code></strong> function, for example:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> MyclubUser<span style=color:#ff79c6>.</span>objects<span style=color:#ff79c6>.</span>all()<span style=color:#ff79c6>.</span>aggregate(Count(<span style=color:#f1fa8c>&#39;id&#39;</span>))
</span></span><span style=display:flex><span>{<span style=color:#f1fa8c>&#39;id__count&#39;</span>: <span style=color:#bd93f9>9</span>}
</span></span></code></pre></div><p>But <strong><code>count()</code></strong> has a cleaner syntax and is likely to be faster on larger datasets.</p><h3 id=in_bulk><code>in_bulk()</code><a hidden class=anchor aria-hidden=true href=#in_bulk>#</a></h3><p><strong><code>in_bulk()</code></strong> takes a list of id values and returns a dictionary mapping each id to an instance of the object with that id. If you don‚Äôt pass a list <code>to **in_bulk()**</code>, all objects will be returned:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> MyclubUser<span style=color:#ff79c6>.</span>objects<span style=color:#ff79c6>.</span>in_bulk()
</span></span><span style=display:flex><span>{<span style=color:#bd93f9>1</span>: <span style=color:#ff79c6>&lt;</span>MyclubUser: Joe Smythe<span style=color:#ff79c6>&gt;</span>, <span style=color:#bd93f9>2</span>: <span style=color:#ff79c6>&lt;</span>MyclubUser: Jane Doe<span style=color:#ff79c6>&gt;</span>, <span style=color:#bd93f9>3</span>: <span style=color:#ff79c6>&lt;</span>MyclubUser: John Jones<span style=color:#ff79c6>&gt;</span>}
</span></span></code></pre></div><p>Once retrieved, you can access each object by their key value:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> usrs[<span style=color:#bd93f9>3</span>]
</span></span><span style=display:flex><span><span style=color:#ff79c6>&lt;</span>MyclubUser: John Jones<span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> usrs[<span style=color:#bd93f9>3</span>]<span style=color:#ff79c6>.</span>first_name   
</span></span><span style=display:flex><span><span style=color:#f1fa8c>&#39;John&#39;</span>
</span></span></code></pre></div><p>Any non-empty list will retrieve all records with the listed ids:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> MyclubUser<span style=color:#ff79c6>.</span>objects<span style=color:#ff79c6>.</span>in_bulk([<span style=color:#bd93f9>1</span>]) 
</span></span><span style=display:flex><span>{<span style=color:#bd93f9>1</span>: <span style=color:#ff79c6>&lt;</span>MyclubUser: Joe Smythe<span style=color:#ff79c6>&gt;</span>}
</span></span></code></pre></div><p>List ids don‚Äôt have to be sequential either:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> MyclubUser<span style=color:#ff79c6>.</span>objects<span style=color:#ff79c6>.</span>in_bulk([<span style=color:#bd93f9>1</span>, <span style=color:#bd93f9>3</span>, <span style=color:#bd93f9>7</span>]) 
</span></span><span style=display:flex><span>{<span style=color:#bd93f9>1</span>: <span style=color:#ff79c6>&lt;</span>MyclubUser: Joe Smythe<span style=color:#ff79c6>&gt;</span>, <span style=color:#bd93f9>3</span>: <span style=color:#ff79c6>&lt;</span>MyclubUser: John Jones<span style=color:#ff79c6>&gt;</span>, <span style=color:#bd93f9>7</span>: <span style=color:#ff79c6>&lt;</span>MyclubUser: Mary Jones<span style=color:#ff79c6>&gt;</span>}
</span></span></code></pre></div><h3 id=latest-and-earliest><code>latest()</code> and <code>earliest()</code><a hidden class=anchor aria-hidden=true href=#latest-and-earliest>#</a></h3><p>Return the latest or the earliest date in the database for the provided field(s):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> <span style=color:#ff79c6>from</span> events.models <span style=color:#ff79c6>import</span> Event
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> Event<span style=color:#ff79c6>.</span>objects<span style=color:#ff79c6>.</span>latest(<span style=color:#f1fa8c>&#39;event_date&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#ff79c6>&lt;</span>Event: Test Event<span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> Event<span style=color:#ff79c6>.</span>objects<span style=color:#ff79c6>.</span>earliest(<span style=color:#f1fa8c>&#39;event_date&#39;</span>) 
</span></span><span style=display:flex><span><span style=color:#ff79c6>&lt;</span>Event: Club Presentation <span style=color:#ff79c6>-</span> Juniors<span style=color:#ff79c6>&gt;</span>
</span></span></code></pre></div><h3 id=first-an-last><code>first()</code> an <code>last()</code><a hidden class=anchor aria-hidden=true href=#first-an-last>#</a></h3><p>Return the first or last object in the QuerySet:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> Event<span style=color:#ff79c6>.</span>objects<span style=color:#ff79c6>.</span>first()
</span></span><span style=display:flex><span><span style=color:#ff79c6>&lt;</span>Event: Test Event<span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> Event<span style=color:#ff79c6>.</span>objects<span style=color:#ff79c6>.</span>last()  
</span></span><span style=display:flex><span><span style=color:#ff79c6>&lt;</span>Event: Gala Day<span style=color:#ff79c6>&gt;</span>
</span></span></code></pre></div><h3 id=aggregate><code>aggregate()</code><a hidden class=anchor aria-hidden=true href=#aggregate>#</a></h3><p>Returns a dictionary of aggregate values calculated over the QuerySet. For example:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> <span style=color:#ff79c6>from</span> django.db.models <span style=color:#ff79c6>import</span> Count
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> Event<span style=color:#ff79c6>.</span>objects<span style=color:#ff79c6>.</span>aggregate(Count(<span style=color:#f1fa8c>&#39;attendees&#39;</span>))
</span></span><span style=display:flex><span>{<span style=color:#f1fa8c>&#39;attendees__count&#39;</span>: <span style=color:#bd93f9>7</span>}
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span>
</span></span></code></pre></div><p>For a list of all aggregate functions available in Django, see Aggregate Functions later in this chapter.</p><h3 id=exists><code>exists()</code><a hidden class=anchor aria-hidden=true href=#exists>#</a></h3><p>Returns <code>True</code> if the returned QuerySet contains any objects, <code>False</code> if the QuerySet is empty. There are two common use cases‚Äîto check if an object is contained in another QuerySet:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> <span style=color:#ff79c6>from</span> events.models <span style=color:#ff79c6>import</span> MyclubUser
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4># Let&#39;s retrieve John Jones from the database</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> usr <span style=color:#ff79c6>=</span> MyclubUser<span style=color:#ff79c6>.</span>objects<span style=color:#ff79c6>.</span>get(first_name<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#39;John&#39;</span>, last_name<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#39;Jones&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4># And check to make sure he is one of the Joneses</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> joneses <span style=color:#ff79c6>=</span> MyclubUser<span style=color:#ff79c6>.</span>objects<span style=color:#ff79c6>.</span>filter(last_name<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#39;Jones&#39;</span>) 
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> joneses<span style=color:#ff79c6>.</span>filter(pk<span style=color:#ff79c6>=</span>usr<span style=color:#ff79c6>.</span>pk)<span style=color:#ff79c6>.</span>exists() 
</span></span><span style=display:flex><span><span style=color:#ff79c6>True</span>
</span></span></code></pre></div><p>And to check if a query returns an object:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> joneses<span style=color:#ff79c6>.</span>filter(first_name<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#39;Mary&#39;</span>)<span style=color:#ff79c6>.</span>exists()
</span></span><span style=display:flex><span><span style=color:#ff79c6>True</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> joneses<span style=color:#ff79c6>.</span>filter(first_name<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#39;Peter&#39;</span>)<span style=color:#ff79c6>.</span>exists() 
</span></span><span style=display:flex><span><span style=color:#ff79c6>False</span>
</span></span></code></pre></div><h2 id=field-lookups>Field Lookups:<a hidden class=anchor aria-hidden=true href=#field-lookups>#</a></h2><p>Field lookups have a simple double-underscore syntax:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff79c6>&lt;</span>searchfield<span style=color:#ff79c6>&gt;</span>__<span style=color:#ff79c6>&lt;</span>lookup<span style=color:#ff79c6>&gt;</span>
</span></span></code></pre></div><p>For example:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> MyclubUser<span style=color:#ff79c6>.</span>objects<span style=color:#ff79c6>.</span>filter(first_name__exact<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;Sally&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#ff79c6>&lt;</span>QuerySet [<span style=color:#ff79c6>&lt;</span>MyclubUser: Sally Jones<span style=color:#ff79c6>&gt;</span>]<span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> MyclubUser<span style=color:#ff79c6>.</span>objects<span style=color:#ff79c6>.</span>filter(first_name__contains<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;Sally&#34;</span>) 
</span></span><span style=display:flex><span><span style=color:#ff79c6>&lt;</span>QuerySet [<span style=color:#ff79c6>&lt;</span>MyclubUser: Sally Jones<span style=color:#ff79c6>&gt;</span>, <span style=color:#ff79c6>&lt;</span>MyclubUser: Sally<span style=color:#ff79c6>-</span>Anne Jones<span style=color:#ff79c6>&gt;</span>]<span style=color:#ff79c6>&gt;</span>
</span></span></code></pre></div><p>Under the hood, Django creates SQL <code>WHERE</code> clauses to construct database queries from the applied lookups. Multiple lookups are allowed and field lookups can also be chained (where logical):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> <span style=color:#ff79c6>from</span> events.models <span style=color:#ff79c6>import</span> Event
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4># Get all events in 2019 that occur before September</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> Event<span style=color:#ff79c6>.</span>objects<span style=color:#ff79c6>.</span>filter(event_date__year<span style=color:#ff79c6>=</span><span style=color:#bd93f9>2019</span>, event_date__month__lt<span style=color:#ff79c6>=</span><span style=color:#bd93f9>9</span>)
</span></span><span style=display:flex><span><span style=color:#ff79c6>&lt;</span>QuerySet [<span style=color:#ff79c6>&lt;</span>Event: Test Event<span style=color:#ff79c6>&gt;</span>, <span style=color:#ff79c6>&lt;</span>Event: Club Presentation <span style=color:#ff79c6>-</span> Juniors<span style=color:#ff79c6>&gt;</span>, <span style=color:#ff79c6>&lt;</span>Event: Club Presentation <span style=color:#ff79c6>-</span> Seniors<span style=color:#ff79c6>&gt;</span>, <span style=color:#ff79c6>&lt;</span>Event: Gala Day<span style=color:#ff79c6>&gt;</span>]<span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4># Get all events occuring on or after the 10th of the month</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> Event<span style=color:#ff79c6>.</span>objects<span style=color:#ff79c6>.</span>filter(event_date__day__gte<span style=color:#ff79c6>=</span><span style=color:#bd93f9>10</span>) 
</span></span><span style=display:flex><span><span style=color:#ff79c6>&lt;</span>QuerySet [<span style=color:#ff79c6>&lt;</span>Event: Test Event<span style=color:#ff79c6>&gt;</span>, <span style=color:#ff79c6>&lt;</span>Event: Club Presentation <span style=color:#ff79c6>-</span> Seniors<span style=color:#ff79c6>&gt;</span>, <span style=color:#ff79c6>&lt;</span>Event: Gala Day<span style=color:#ff79c6>&gt;</span>]<span style=color:#ff79c6>&gt;</span>
</span></span></code></pre></div><table><thead><tr><th>Filter</th><th>Description</th></tr></thead><tbody><tr><td><strong><code>exact</code>/<code>iexact</code></strong></td><td>Exact match. <code>iexact</code> is case-insensitive version</td></tr><tr><td><strong><code>contains</code>/<code>icontains</code></strong></td><td>Field contains search text. <code>icontains</code> is case-insensitive version</td></tr><tr><td><strong><code>in</code></strong></td><td>In a given iterable (list, tuple or QuerySet)</td></tr><tr><td><strong><code>gt</code>/<code>gte</code></strong></td><td>Greater than/greater than or equal</td></tr><tr><td><strong><code>lt</code>/<code>lte</code></strong></td><td>Less than/less than or equal</td></tr><tr><td><strong><code>startswith</code>/<code>istartswith</code></strong></td><td>Starts with search string. <code>istartswith</code> is case-insensitive version</td></tr><tr><td><strong><code>endswith</code>/<code>iendswith</code></strong></td><td>Ends with search string. <code>iendswith</code>is case-insensitive version</td></tr><tr><td><strong><code>range</code></strong></td><td>Range test. Range includes start and finish values</td></tr><tr><td><strong><code>date</code></strong></td><td>Casts the value as a date. For datetime field lookups</td></tr><tr><td><strong><code>year</code></strong></td><td>Searches an exact year match</td></tr><tr><td><strong><code>iso_year</code></strong></td><td>Searches an exact ISO 8601 year match</td></tr><tr><td><strong><code>month</code></strong></td><td>Searches an exact month match</td></tr><tr><td><strong><code>day</code></strong></td><td>Searches an exact day match</td></tr><tr><td><strong><code>week</code></strong></td><td>Searches an exact week match</td></tr><tr><td><strong><code>week_day</code></strong></td><td>Searches an exact day of the week match</td></tr><tr><td><strong><code>quarter</code></strong></td><td>Searches an exact quarter of the year match. Valid integer range: 1‚Äì4</td></tr><tr><td><strong><code>time</code></strong></td><td>Casts the value as a time. For datetime field lookups</td></tr><tr><td><strong><code>hour</code></strong></td><td>Searches an exact hour match</td></tr><tr><td><strong><code>minute</code></strong></td><td>Searches an exact minute match</td></tr><tr><td><strong><code>second</code></strong></td><td>Searches an exact second match</td></tr><tr><td><strong><code>isnull</code></strong></td><td>Search if field is null. Takes <code>True</code> or <code>False</code></td></tr><tr><td><strong><code>regex</code>/<code>iregex</code></strong></td><td>Regular expression match. <code>iregex</code> is case-insensitive version</td></tr></tbody></table><h2 id=aggregate-functions>Aggregate Functions:<a hidden class=anchor aria-hidden=true href=#aggregate-functions>#</a></h2><p>Django includes seven aggregate functions:</p><ul><li><strong><code>Avg</code></strong>. Returns the mean value of the expression</li><li><strong><code>Count</code></strong>. Count the number of returned objects</li><li><strong><code>Max</code></strong>. Returns the maximum value of the expression</li><li><strong><code>Min</code></strong>. Returns the minimum value of the expression</li><li><strong><code>StdDev</code></strong>. Returns the population standard deviation of the data in the expression</li><li><strong><code>Sum</code></strong>. Returns the sum of all values in the expression</li><li><strong><code>Variance</code></strong>. Returns the population variance of the data in the expression</li></ul><p>They are translated to the equivalent SQL by Django‚Äôs ORM.</p><p>Aggregate functions can either be used directly:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> <span style=color:#ff79c6>from</span> events.models <span style=color:#ff79c6>import</span> Event
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> Event<span style=color:#ff79c6>.</span>objects<span style=color:#ff79c6>.</span>count()
</span></span><span style=display:flex><span><span style=color:#bd93f9>4</span>
</span></span></code></pre></div><p>Or with the <strong><code>aggregate()</code></strong> function:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> <span style=color:#ff79c6>from</span> django.db.models <span style=color:#ff79c6>import</span> Count 
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> Event<span style=color:#ff79c6>.</span>objects<span style=color:#ff79c6>.</span>aggregate(Count(<span style=color:#f1fa8c>&#39;id&#39;</span>))
</span></span><span style=display:flex><span>{<span style=color:#f1fa8c>&#39;id__count&#39;</span>: <span style=color:#bd93f9>4</span>}
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> <span style=color:#ff79c6>from</span> django.db.models <span style=color:#ff79c6>import</span> Avg, Max, Min, Sum, Count
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> User<span style=color:#ff79c6>.</span>objects<span style=color:#ff79c6>.</span>all()<span style=color:#ff79c6>.</span>aggregate(Avg(<span style=color:#f1fa8c>&#39;id&#39;</span>))
</span></span><span style=display:flex><span>{<span style=color:#f1fa8c>&#39;id__avg&#39;</span>: <span style=color:#bd93f9>7.571428571428571</span>}
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> User<span style=color:#ff79c6>.</span>objects<span style=color:#ff79c6>.</span>all()<span style=color:#ff79c6>.</span>aggregate(Max(<span style=color:#f1fa8c>&#39;id&#39;</span>))
</span></span><span style=display:flex><span>{<span style=color:#f1fa8c>&#39;id__max&#39;</span>: <span style=color:#bd93f9>15</span>}
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> User<span style=color:#ff79c6>.</span>objects<span style=color:#ff79c6>.</span>all()<span style=color:#ff79c6>.</span>aggregate(Min(<span style=color:#f1fa8c>&#39;id&#39;</span>))
</span></span><span style=display:flex><span>{<span style=color:#f1fa8c>&#39;id__min&#39;</span>: <span style=color:#bd93f9>1</span>}
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> User<span style=color:#ff79c6>.</span>objects<span style=color:#ff79c6>.</span>all()<span style=color:#ff79c6>.</span>aggregate(Sum(<span style=color:#f1fa8c>&#39;id&#39;</span>))
</span></span><span style=display:flex><span>{<span style=color:#f1fa8c>&#39;id__sum&#39;</span>: <span style=color:#bd93f9>106</span>}
</span></span></code></pre></div><h2 id=more-complex-queries>More Complex Queries<a hidden class=anchor aria-hidden=true href=#more-complex-queries>#</a></h2><h3 id=query-expressions><strong>Query Expressions</strong><a hidden class=anchor aria-hidden=true href=#query-expressions>#</a></h3><p>Query expressions describe a computation or value used as a part of another query. There are six built-in query expressions:</p><ul><li><strong><code>F()</code></strong>‚ÄîRepresents the value of a model field or annotated column</li><li><strong><code>Func()</code></strong>‚ÄîBase type for database functions like <code>LOWER</code> and <code>SUM</code></li><li><strong><code>Aggregate()</code></strong>‚ÄîAll aggregate functions inherit from <code>Aggregate()</code></li><li><strong><code>Value()</code></strong>‚ÄîExpression value. Not used directly</li><li><strong><code>ExpressionWrapper()</code></strong>‚ÄîUsed to wrap expressions of different types</li><li><strong><code>SubQuery()</code></strong>‚ÄîAdd a subquery to a QuerySet</li></ul><p>Django supports multiple arithmetic operators with query expressions, including:</p><ul><li>Addition and subtraction</li><li>Multiplication and division</li><li>Negation</li><li>Modulo arithmetic; and</li><li>The power operator</li></ul><p>We have already covered aggregation in this chapter, so let‚Äôs have a quick look at the other two commonly used query expressions: <strong><code>F()</code></strong> and <strong><code>Func()</code></strong>.</p><h3 id=f-expressions><code>F()</code> Expressions:<a hidden class=anchor aria-hidden=true href=#f-expressions>#</a></h3><p>The two primary uses for <strong><code>F()</code></strong> expressions is to move computational arithmetic from Python to the database and to reference other fields in the model.</p><p>Let‚Äôs start with a simple example, say we want to delay the first event in the event calendar by two weeks. A conventional approach would look like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> <span style=color:#ff79c6>from</span> events.models <span style=color:#ff79c6>import</span> Event
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> <span style=color:#ff79c6>import</span> datetime
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> e <span style=color:#ff79c6>=</span> Event<span style=color:#ff79c6>.</span>objects<span style=color:#ff79c6>.</span>get(<span style=color:#8be9fd;font-style:italic>id</span><span style=color:#ff79c6>=</span><span style=color:#bd93f9>1</span>)
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> e<span style=color:#ff79c6>.</span>event_date <span style=color:#ff79c6>+=</span> datetime<span style=color:#ff79c6>.</span>timedelta(days<span style=color:#ff79c6>=</span><span style=color:#bd93f9>14</span>)
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> e<span style=color:#ff79c6>.</span>save()
</span></span></code></pre></div><p>In this example, Django retrieves the information from the database into memory, uses Python to perform the computation‚Äîin this case, add 14 days to the event date‚Äîand then saves the record back to the database.</p><p>For this example, the overhead for using Python to perform the date arithmetic is not onerous, however for more complex queries there is a definite advantage to moving the computational load to the database.</p><p>Now let‚Äôs see how we accomplish the same task with an <strong><code>F()</code></strong> expression:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> <span style=color:#ff79c6>from</span> django.db.models <span style=color:#ff79c6>import</span> F
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> e <span style=color:#ff79c6>=</span> Event<span style=color:#ff79c6>.</span>objects<span style=color:#ff79c6>.</span>get(<span style=color:#8be9fd;font-style:italic>id</span><span style=color:#ff79c6>=</span><span style=color:#bd93f9>1</span>)    
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> e<span style=color:#ff79c6>.</span>event_date <span style=color:#ff79c6>=</span> F(<span style=color:#f1fa8c>&#39;event_date&#39;</span>) <span style=color:#ff79c6>+</span> datetime<span style=color:#ff79c6>.</span>timedelta(days<span style=color:#ff79c6>=</span><span style=color:#bd93f9>14</span>)
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> e<span style=color:#ff79c6>.</span>save()
</span></span></code></pre></div><p>In terms of the amount of code necessary to complete the task, we haven‚Äôt saved anything, however, by using the <strong><code>F()</code></strong> expression, Django will now create an SQL query that performs the computational logic inside the database, rather than in memory with Python.</p><p>While this takes a huge load off the Django application in the case of executing complex computations, there is one drawback‚Äîbecause the calculations take place inside the database, Django is now out of sync with the updated state of the database. We can test this by looking at the <code>Event</code> object instance:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> e<span style=color:#ff79c6>.</span>event_date 
</span></span><span style=display:flex><span><span style=color:#ff79c6>&lt;</span>CombinedExpression: F(event_date) <span style=color:#ff79c6>+</span> DurationValue(<span style=color:#bd93f9>14</span> days, <span style=color:#bd93f9>0</span>:<span style=color:#bd93f9>00</span>:<span style=color:#bd93f9>00</span>)<span style=color:#ff79c6>&gt;</span>
</span></span></code></pre></div><p>To retrieve the updated object from the database, we need to use the <strong><code>refresh_from_db()</code></strong> function:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> e<span style=color:#ff79c6>.</span>refresh_from_db()
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> e<span style=color:#ff79c6>.</span>event_date
</span></span><span style=display:flex><span>datetime<span style=color:#ff79c6>.</span>datetime(<span style=color:#bd93f9>2019</span>, <span style=color:#bd93f9>9</span>, <span style=color:#bd93f9>8</span>, <span style=color:#bd93f9>22</span>, <span style=color:#bd93f9>42</span>, <span style=color:#bd93f9>15</span>, tzinfo<span style=color:#ff79c6>=</span>datetime<span style=color:#ff79c6>.</span>timezone(datetime<span style=color:#ff79c6>.</span>timedelta(<span style=color:#bd93f9>0</span>), <span style=color:#f1fa8c>&#39;+0000&#39;</span>))
</span></span></code></pre></div><p>The second use for <strong><code>F()</code></strong> expressions‚Äîreferencing other model fields‚Äîis straight forward. For example, you can check for users with the same first and last name:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> MyclubUser<span style=color:#ff79c6>.</span>objects<span style=color:#ff79c6>.</span>filter(first_name<span style=color:#ff79c6>=</span>F(<span style=color:#f1fa8c>&#39;last_name&#39;</span>))
</span></span><span style=display:flex><span><span style=color:#ff79c6>&lt;</span>QuerySet [<span style=color:#ff79c6>&lt;</span>MyclubUser: Don Don<span style=color:#ff79c6>&gt;</span>]<span style=color:#ff79c6>&gt;</span>
</span></span></code></pre></div><p>This simple syntax works with all of Django‚Äôs field lookups and aggregate functions.</p><h3 id=func-expressions><code>Func()</code> Expressions<a hidden class=anchor aria-hidden=true href=#func-expressions>#</a></h3><p><strong><code>Func()</code></strong> expressions can be used to represent any function supported by the underlying database (e.g. <code>LOWER</code>, <code>UPPER</code>, <code>LEN</code>, <code>TRIM</code>, <code>CONCAT</code>, etc.). For example:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> <span style=color:#ff79c6>from</span> events.models <span style=color:#ff79c6>import</span> MyclubUser
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> <span style=color:#ff79c6>from</span> django.db.models <span style=color:#ff79c6>import</span> F, Func
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> qry <span style=color:#ff79c6>=</span> usrs<span style=color:#ff79c6>.</span>annotate(f_upper<span style=color:#ff79c6>=</span>Func(F(<span style=color:#f1fa8c>&#39;last_name&#39;</span>), function<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#39;UPPER&#39;</span>)) 
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> <span style=color:#ff79c6>for</span> usr <span style=color:#ff79c6>in</span> qry:
</span></span><span style=display:flex><span><span style=color:#ff79c6>...</span>     <span style=color:#8be9fd;font-style:italic>print</span>(usr<span style=color:#ff79c6>.</span>first_name, usr<span style=color:#ff79c6>.</span>f_upper)
</span></span><span style=display:flex><span><span style=color:#ff79c6>...</span> 
</span></span><span style=display:flex><span>Joe SMYTHE
</span></span><span style=display:flex><span>Jane DOE
</span></span><span style=display:flex><span>John JONES
</span></span><span style=display:flex><span>Sally JONES
</span></span><span style=display:flex><span>Sally<span style=color:#ff79c6>-</span>Anne JONES
</span></span><span style=display:flex><span>Sarah JONES
</span></span><span style=display:flex><span>Mary JONES
</span></span><span style=display:flex><span>Jane SMYTHE
</span></span><span style=display:flex><span>Steve SMITH
</span></span><span style=display:flex><span>Don DON
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span>
</span></span></code></pre></div><p>Notice how we are using <strong><code>F()</code></strong> expressions again to reference another field in the <strong><code>MyclubUser</code></strong> model.</p><h3 id=q-objects><code>Q()</code> Objects:<a hidden class=anchor aria-hidden=true href=#q-objects>#</a></h3><p>Like <strong><code>F()</code></strong> expressions, a <strong><code>Q()</code></strong> object encapsulates an SQL expression inside a Python object. <strong><code>Q()</code></strong> objects are most often used to construct complex database queries by chaining together multiple expressions using <strong><code>AND</code> (<code>&</code>)</strong> and <strong><code>OR</code> (<code>|</code>)</strong> operators:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> <span style=color:#ff79c6>from</span> events.models <span style=color:#ff79c6>import</span> MyclubUser 
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> <span style=color:#ff79c6>from</span> django.db.models <span style=color:#ff79c6>import</span> Q
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> Q1 <span style=color:#ff79c6>=</span> Q(first_name__startswith<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#39;J&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> Q2 <span style=color:#ff79c6>=</span> Q(first_name__endswith<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#39;e&#39;</span>) 
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> MyclubUser<span style=color:#ff79c6>.</span>objects<span style=color:#ff79c6>.</span>filter(Q1 <span style=color:#ff79c6>&amp;</span> Q2)
</span></span><span style=display:flex><span><span style=color:#ff79c6>&lt;</span>QuerySet [<span style=color:#ff79c6>&lt;</span>MyclubUser: Joe Smythe<span style=color:#ff79c6>&gt;</span>, <span style=color:#ff79c6>&lt;</span>MyclubUser: Jane Doe<span style=color:#ff79c6>&gt;</span>, <span style=color:#ff79c6>&lt;</span>MyclubUser: Jane Smythe<span style=color:#ff79c6>&gt;</span>]<span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> MyclubUser<span style=color:#ff79c6>.</span>objects<span style=color:#ff79c6>.</span>filter(Q1 <span style=color:#ff79c6>|</span> Q2) 
</span></span><span style=display:flex><span><span style=color:#ff79c6>&lt;</span>QuerySet [<span style=color:#ff79c6>&lt;</span>MyclubUser: Joe Smythe<span style=color:#ff79c6>&gt;</span>, <span style=color:#ff79c6>&lt;</span>MyclubUser: Jane Doe<span style=color:#ff79c6>&gt;</span>, <span style=color:#ff79c6>&lt;</span>MyclubUser: John Jones<span style=color:#ff79c6>&gt;</span>, <span style=color:#ff79c6>&lt;</span>MyclubUser: Sally<span style=color:#ff79c6>-</span>Anne Jones<span style=color:#ff79c6>&gt;</span>, <span style=color:#ff79c6>&lt;</span>MyclubUser: Jane Smythe<span style=color:#ff79c6>&gt;</span>, <span style=color:#ff79c6>&lt;</span>MyclubUser: Steve Smith<span style=color:#ff79c6>&gt;</span>]<span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span>
</span></span></code></pre></div><p>You can also perform <strong><code>NOT</code></strong> queries using the negate <strong>(<code>~</code>)</strong> character:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> MyclubUser<span style=color:#ff79c6>.</span>objects<span style=color:#ff79c6>.</span>filter(<span style=color:#ff79c6>~</span>Q2)      
</span></span><span style=display:flex><span><span style=color:#ff79c6>&lt;</span>QuerySet [<span style=color:#ff79c6>&lt;</span>MyclubUser: John Jones<span style=color:#ff79c6>&gt;</span>, <span style=color:#ff79c6>&lt;</span>MyclubUser: Sally Jones<span style=color:#ff79c6>&gt;</span>, <span style=color:#ff79c6>&lt;</span>MyclubUser: Sarah Jones<span style=color:#ff79c6>&gt;</span>, <span style=color:#ff79c6>&lt;</span>MyclubUser: Mary Jones<span style=color:#ff79c6>&gt;</span>, <span style=color:#ff79c6>&lt;</span>MyclubUser: Don Don<span style=color:#ff79c6>&gt;</span>]<span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> MyclubUser<span style=color:#ff79c6>.</span>objects<span style=color:#ff79c6>.</span>filter(Q1 <span style=color:#ff79c6>&amp;</span> <span style=color:#ff79c6>~</span>Q2) 
</span></span><span style=display:flex><span><span style=color:#ff79c6>&lt;</span>QuerySet [<span style=color:#ff79c6>&lt;</span>MyclubUser: John Jones<span style=color:#ff79c6>&gt;</span>]<span style=color:#ff79c6>&gt;</span>
</span></span></code></pre></div><h2 id=model-managers>Model Managers:<a hidden class=anchor aria-hidden=true href=#model-managers>#</a></h2><p>A <code>Manager</code> is a Django class that provides the interface between database query operations and a Django model. Each Django model is provided with a <strong>default <code>Manager</code></strong> named <strong><code>objects</code></strong>. We have been using the default manager every time we query the database, for example:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> newevent <span style=color:#ff79c6>=</span> Event<span style=color:#ff79c6>.</span>objects<span style=color:#ff79c6>.</span>get(name<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;Xmas Barbeque&#34;</span>)
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> joneses <span style=color:#ff79c6>=</span> MyclubUser<span style=color:#ff79c6>.</span>objects<span style=color:#ff79c6>.</span>filter(last_name<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#39;Jones&#39;</span>)
</span></span></code></pre></div><p>In each example, <strong><code>objects</code></strong> is the <strong>default <code>Manager</code></strong> for the model instance.</p><p>You can customize the default <strong><code>Manager</code></strong> class, by extending the base <code>Manager</code> class for the model. The two most common use-cases for customizing the default manager are:</p><ul><li>Adding extra manager methods; and</li><li>Modifying initial QuerySet results.</li></ul><h3 id=adding-extra-manager-methods>Adding Extra Manager Methods:<a hidden class=anchor aria-hidden=true href=#adding-extra-manager-methods>#</a></h3><p>Extra manager methods add table-level functionality to models. To add row-level functions, i.e. methods that act on single instances of the model, you use model methods, which we cover in the next section of the chapter.</p><p>Extra manager methods are created by inheriting the <code>Manager</code> base class and adding custom functions to the custom <code>Manager</code> class. For example, let‚Äôs create an extra manager method for the <code>Event</code> model that retrieves the total number of events for a particular type of event (e.g. gala day or presentation):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#6272a4># myclub_rooteventsmodels.py</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>from</span> django.db <span style=color:#ff79c6>import</span> models
</span></span><span style=display:flex><span><span style=color:#ff79c6>from</span> django.contrib.auth.models <span style=color:#ff79c6>import</span> User
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4># ...</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#bd93f9>1</span>  <span style=color:#ff79c6>class</span> <span style=color:#50fa7b>EventManager</span>(models<span style=color:#ff79c6>.</span>Manager):
</span></span><span style=display:flex><span><span style=color:#bd93f9>2</span>      <span style=color:#ff79c6>def</span> <span style=color:#50fa7b>event_type_count</span>(self, event_type):
</span></span><span style=display:flex><span><span style=color:#bd93f9>3</span>          <span style=color:#ff79c6>return</span> self<span style=color:#ff79c6>.</span>filter(name__icontains<span style=color:#ff79c6>=</span>event_type)<span style=color:#ff79c6>.</span>count()
</span></span><span style=display:flex><span><span style=color:#bd93f9>4</span>  
</span></span><span style=display:flex><span><span style=color:#bd93f9>5</span>  
</span></span><span style=display:flex><span><span style=color:#bd93f9>6</span>  <span style=color:#ff79c6>class</span> <span style=color:#50fa7b>Event</span>(models<span style=color:#ff79c6>.</span>Model):
</span></span><span style=display:flex><span><span style=color:#bd93f9>7</span>      name <span style=color:#ff79c6>=</span> models<span style=color:#ff79c6>.</span>CharField(<span style=color:#f1fa8c>&#39;Event Name&#39;</span>, max_length<span style=color:#ff79c6>=</span><span style=color:#bd93f9>120</span>)
</span></span><span style=display:flex><span><span style=color:#bd93f9>8</span>      event_date <span style=color:#ff79c6>=</span> models<span style=color:#ff79c6>.</span>DateTimeField(<span style=color:#f1fa8c>&#39;Event Date&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#bd93f9>9</span>      venue <span style=color:#ff79c6>=</span> models<span style=color:#ff79c6>.</span>ForeignKey(Venue, on_delete<span style=color:#ff79c6>=</span>models<span style=color:#ff79c6>.</span>CASCADE)
</span></span><span style=display:flex><span><span style=color:#bd93f9>10</span>     manager <span style=color:#ff79c6>=</span> models<span style=color:#ff79c6>.</span>ForeignKey(User, blank<span style=color:#ff79c6>=</span><span style=color:#ff79c6>True</span>, null<span style=color:#ff79c6>=</span><span style=color:#ff79c6>True</span>, on_delete<span style=color:#ff79c6>=</span>models<span style=color:#ff79c6>.</span>SET_NULL)
</span></span><span style=display:flex><span><span style=color:#bd93f9>11</span>     attendees <span style=color:#ff79c6>=</span> models<span style=color:#ff79c6>.</span>ManyToManyField(MyclubUser)
</span></span><span style=display:flex><span><span style=color:#bd93f9>12</span>     description <span style=color:#ff79c6>=</span> models<span style=color:#ff79c6>.</span>TextField(blank<span style=color:#ff79c6>=</span><span style=color:#ff79c6>True</span>)
</span></span><span style=display:flex><span><span style=color:#bd93f9>13</span>     objects <span style=color:#ff79c6>=</span> EventManager()
</span></span><span style=display:flex><span><span style=color:#bd93f9>14</span>
</span></span><span style=display:flex><span><span style=color:#bd93f9>15</span>     <span style=color:#ff79c6>def</span> __str__(self):
</span></span><span style=display:flex><span><span style=color:#bd93f9>16</span>         <span style=color:#ff79c6>return</span> self<span style=color:#ff79c6>.</span>name
</span></span></code></pre></div><ul><li>In <strong>Line 1</strong>, we‚Äôve entered a new class called <code>EventManager</code> that inherits from Django‚Äôs <strong><code>models.Manager</code></strong> base class.</li><li><strong>Lines 2 and 3</strong> is the extra <code>Manager</code> method we‚Äôre adding to the model. This new method returns the total number of the specified event type. Note we‚Äôre using the <code>icontains</code> field lookup to return all events that have the key phrase in the title.</li><li>In <strong>Line 13</strong> we‚Äôre replacing the default manager with our new <code>EventManager</code> class. Note that <code>EventManager</code> inherits from the <code>Manager</code> base class, so all the default manager methods like <strong><code>all()</code></strong> and <strong><code>filter()</code></strong> are automatically included in the custom <strong><code>EventManager()</code></strong> class.</li></ul><p>Once it has been created, you can use your new manager method just like any other model menthod:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> <span style=color:#ff79c6>from</span> events.models <span style=color:#ff79c6>import</span> Event
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> Event<span style=color:#ff79c6>.</span>objects<span style=color:#ff79c6>.</span>event_type_count(<span style=color:#f1fa8c>&#39;Gala Day&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#bd93f9>1</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> Event<span style=color:#ff79c6>.</span>objects<span style=color:#ff79c6>.</span>event_type_count(<span style=color:#f1fa8c>&#39;Presentation&#39;</span>) 
</span></span><span style=display:flex><span><span style=color:#bd93f9>2</span>
</span></span></code></pre></div><h3 id=renaming-the-default-model-manager>Renaming the Default Model Manager<a hidden class=anchor aria-hidden=true href=#renaming-the-default-model-manager>#</a></h3><p>While the base manager for each model is named <strong><code>objects</code></strong> by default, you can change the name of the default manager in your class declaration. For example, to change the default manager name for our Event class from objects to events, we just need to change line 13 in the code above from:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#bd93f9>13</span>     objects <span style=color:#ff79c6>=</span> EventManager()
</span></span></code></pre></div><p>To:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#bd93f9>13</span>     events <span style=color:#ff79c6>=</span> EventManager()
</span></span></code></pre></div><p>Now you can refer to the default manager like so:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> <span style=color:#ff79c6>from</span> events.models <span style=color:#ff79c6>import</span> Event 
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> Event<span style=color:#ff79c6>.</span>events<span style=color:#ff79c6>.</span>all()
</span></span><span style=display:flex><span><span style=color:#ff79c6>&lt;</span>QuerySet [<span style=color:#ff79c6>&lt;</span>Event: Test Event<span style=color:#ff79c6>&gt;</span>, <span style=color:#ff79c6>&lt;</span>Event: Club Presentation <span style=color:#ff79c6>-</span> Juniors<span style=color:#ff79c6>&gt;</span>, <span style=color:#ff79c6>&lt;</span>Event: Club Presentation <span style=color:#ff79c6>-</span> Seniors<span style=color:#ff79c6>&gt;</span>, <span style=color:#ff79c6>&lt;</span>Event: Gala Day<span style=color:#ff79c6>&gt;</span>]<span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> 
</span></span></code></pre></div><h3 id=overriding-initial-manager-querysets>Overriding Initial Manager QuerySets<a hidden class=anchor aria-hidden=true href=#overriding-initial-manager-querysets>#</a></h3><p>To modify what is returned by the default manager QuerySet, you override the <code>Manager.get_queryset()</code> method. This is easiest to understand with an example. Let‚Äôs say we commonly have to check what venues are listed in our local city. To cut down on the number of queries we have to write, we‚Äôre going to create a custom manager for our <code>Venue</code> model (changes in bold):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#6272a4># myclub_rooteventsmodels.py</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#bd93f9>1</span>  <span style=color:#ff79c6>from</span> django.db <span style=color:#ff79c6>import</span> models
</span></span><span style=display:flex><span><span style=color:#bd93f9>2</span>  <span style=color:#ff79c6>from</span> django.contrib.auth.models <span style=color:#ff79c6>import</span> User
</span></span><span style=display:flex><span><span style=color:#bd93f9>3</span>  
</span></span><span style=display:flex><span><span style=color:#bd93f9>4</span>  
</span></span><span style=display:flex><span><span style=color:#bd93f9>5</span>  <span style=color:#ff79c6>class</span> <span style=color:#50fa7b>VenueManager</span>(models<span style=color:#ff79c6>.</span>Manager):
</span></span><span style=display:flex><span><span style=color:#bd93f9>6</span>      <span style=color:#ff79c6>def</span> <span style=color:#50fa7b>get_queryset</span>(self):
</span></span><span style=display:flex><span><span style=color:#bd93f9>7</span>          <span style=color:#ff79c6>return</span> <span style=color:#8be9fd;font-style:italic>super</span>(VenueManager, self)<span style=color:#ff79c6>.</span>get_queryset()<span style=color:#ff79c6>.</span>filter(zip_code<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#39;00000&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#bd93f9>8</span>  
</span></span><span style=display:flex><span><span style=color:#bd93f9>9</span>  
</span></span><span style=display:flex><span><span style=color:#bd93f9>10</span> <span style=color:#ff79c6>class</span> <span style=color:#50fa7b>Venue</span>(models<span style=color:#ff79c6>.</span>Model):
</span></span><span style=display:flex><span><span style=color:#bd93f9>11</span>     name <span style=color:#ff79c6>=</span> models<span style=color:#ff79c6>.</span>CharField(<span style=color:#f1fa8c>&#39;Venue Name&#39;</span>, max_length<span style=color:#ff79c6>=</span><span style=color:#bd93f9>120</span>)
</span></span><span style=display:flex><span><span style=color:#bd93f9>12</span>     address <span style=color:#ff79c6>=</span> models<span style=color:#ff79c6>.</span>CharField(max_length<span style=color:#ff79c6>=</span><span style=color:#bd93f9>300</span>)
</span></span><span style=display:flex><span><span style=color:#bd93f9>13</span>     zip_code <span style=color:#ff79c6>=</span> models<span style=color:#ff79c6>.</span>CharField(<span style=color:#f1fa8c>&#39;Zip/Post Code&#39;</span>, max_length<span style=color:#ff79c6>=</span><span style=color:#bd93f9>12</span>)
</span></span><span style=display:flex><span><span style=color:#bd93f9>14</span>     phone <span style=color:#ff79c6>=</span> models<span style=color:#ff79c6>.</span>CharField(<span style=color:#f1fa8c>&#39;Contact Phone&#39;</span>, max_length<span style=color:#ff79c6>=</span><span style=color:#bd93f9>20</span>, blank<span style=color:#ff79c6>=</span><span style=color:#ff79c6>True</span>)
</span></span><span style=display:flex><span><span style=color:#bd93f9>15</span>     web <span style=color:#ff79c6>=</span> models<span style=color:#ff79c6>.</span>URLField(<span style=color:#f1fa8c>&#39;Web Address&#39;</span>, blank<span style=color:#ff79c6>=</span><span style=color:#ff79c6>True</span>)
</span></span><span style=display:flex><span><span style=color:#bd93f9>16</span>     email_address <span style=color:#ff79c6>=</span> models<span style=color:#ff79c6>.</span>EmailField(<span style=color:#f1fa8c>&#39;Email Address&#39;</span>,blank<span style=color:#ff79c6>=</span><span style=color:#ff79c6>True</span>)
</span></span><span style=display:flex><span><span style=color:#bd93f9>17</span> 
</span></span><span style=display:flex><span><span style=color:#bd93f9>18</span>     venues <span style=color:#ff79c6>=</span> models<span style=color:#ff79c6>.</span>Manager()
</span></span><span style=display:flex><span><span style=color:#bd93f9>19</span>     local_venues <span style=color:#ff79c6>=</span> VenueManager()
</span></span><span style=display:flex><span><span style=color:#bd93f9>20</span> 
</span></span><span style=display:flex><span><span style=color:#bd93f9>21</span>     <span style=color:#ff79c6>def</span> __str__(self):
</span></span><span style=display:flex><span><span style=color:#bd93f9>22</span>        <span style=color:#ff79c6>return</span> self<span style=color:#ff79c6>.</span>name
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4># ...</span>
</span></span></code></pre></div><p>Let‚Äôs take a look at the changes:</p><ul><li><strong>Lines 5 to 7</strong> is the new <code>VenueManager</code> class. The structure is the same as the <code>EventManager</code> class, except this time we‚Äôre overriding the default <code>get_queryset()</code> method and returning a filtered list that only contains local venues.</li><li>In <strong>Line 18</strong> I have renamed the default manager to <code>venues</code></li><li>In <strong>Line 19</strong> we‚Äôre adding the custom model manager (<code>VenueManager</code>)</li></ul><p>Note that there is no limit to how many custom managers you can add to a Django model instance. This makes creating custom filters for commonly used queries a breeze. Once you have save the <a href=http://models.py/>models.py</a> file, you can use the custom methods in your code. For example, the default manager method has been renamed, so you can use the more intuitive <code>venues</code>, instead of <code>objects</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> Venue<span style=color:#ff79c6>.</span>venues<span style=color:#ff79c6>.</span>all()  
</span></span><span style=display:flex><span><span style=color:#ff79c6>&lt;</span>QuerySet [<span style=color:#ff79c6>&lt;</span>Venue: South Stadium<span style=color:#ff79c6>&gt;</span>, <span style=color:#ff79c6>&lt;</span>Venue: West Park<span style=color:#ff79c6>&gt;</span>, <span style=color:#ff79c6>&lt;</span>Venue: North Stadium<span style=color:#ff79c6>&gt;</span>, <span style=color:#ff79c6>&lt;</span>Venue: East Park<span style=color:#ff79c6>&gt;</span>]<span style=color:#ff79c6>&gt;</span>
</span></span></code></pre></div><p>And our new custom manager is also easily accessible:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> <span style=color:#ff79c6>from</span> events.models <span style=color:#ff79c6>import</span> Venue
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> Venue<span style=color:#ff79c6>.</span>local_venues<span style=color:#ff79c6>.</span>all()
</span></span><span style=display:flex><span><span style=color:#ff79c6>&lt;</span>QuerySet [<span style=color:#ff79c6>&lt;</span>Venue: West Park<span style=color:#ff79c6>&gt;</span>]<span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span>
</span></span></code></pre></div><h2 id=model-methods>Model Methods<a hidden class=anchor aria-hidden=true href=#model-methods>#</a></h2><p>Django‚Äôs <code>Model</code> class comes with many built-in methods. We have already used many of them - <strong><code>save()</code></strong>, <strong><code>delete()</code></strong>, <strong><code>__str__()</code></strong> and others. Where manager methods add table-level functionality to Django‚Äôs models, model methods add row-level functions that act on individual instances of the model.</p><p>There are two common cases where you want to play with model methods:</p><ol><li>When you want to add business logic to the model by adding custom model methods; and</li><li>When you want to override the default behavior of a built-in model method.</li></ol><h3 id=custom-model-methods>Custom Model Methods<a hidden class=anchor aria-hidden=true href=#custom-model-methods>#</a></h3><p>As always, it‚Äôs far easier to understand how custom model methods work by writing a couple, so let‚Äôs go ahead and modify our <code>Event</code> class (changes in bold):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#6272a4># myclub_rooteventsmodels.py</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4># ...</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#bd93f9>1</span>  <span style=color:#ff79c6>class</span> <span style=color:#50fa7b>Event</span>(models<span style=color:#ff79c6>.</span>Model):
</span></span><span style=display:flex><span><span style=color:#bd93f9>2</span>      name <span style=color:#ff79c6>=</span> models<span style=color:#ff79c6>.</span>CharField(<span style=color:#f1fa8c>&#39;Event Name&#39;</span>, max_length<span style=color:#ff79c6>=</span><span style=color:#bd93f9>120</span>)
</span></span><span style=display:flex><span><span style=color:#bd93f9>3</span>      event_date <span style=color:#ff79c6>=</span> models<span style=color:#ff79c6>.</span>DateTimeField(<span style=color:#f1fa8c>&#39;Event Date&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#bd93f9>4</span>      venue <span style=color:#ff79c6>=</span> models<span style=color:#ff79c6>.</span>ForeignKey(Venue, on_delete<span style=color:#ff79c6>=</span>models<span style=color:#ff79c6>.</span>CASCADE)
</span></span><span style=display:flex><span><span style=color:#bd93f9>5</span>      manager <span style=color:#ff79c6>=</span> models<span style=color:#ff79c6>.</span>ForeignKey(User, blank<span style=color:#ff79c6>=</span><span style=color:#ff79c6>True</span>, null<span style=color:#ff79c6>=</span><span style=color:#ff79c6>True</span>, on_delete<span style=color:#ff79c6>=</span>models<span style=color:#ff79c6>.</span>SET_NULL)
</span></span><span style=display:flex><span><span style=color:#bd93f9>6</span>      attendees <span style=color:#ff79c6>=</span> models<span style=color:#ff79c6>.</span>ManyToManyField(MyclubUser)
</span></span><span style=display:flex><span><span style=color:#bd93f9>7</span>      description <span style=color:#ff79c6>=</span> models<span style=color:#ff79c6>.</span>TextField(blank<span style=color:#ff79c6>=</span><span style=color:#ff79c6>True</span>)
</span></span><span style=display:flex><span><span style=color:#bd93f9>8</span>      events <span style=color:#ff79c6>=</span> EventManager()
</span></span><span style=display:flex><span><span style=color:#bd93f9>9</span>  
</span></span><span style=display:flex><span><span style=color:#bd93f9>10</span>     <span style=color:#ff79c6>def</span> <span style=color:#50fa7b>event_timing</span>(self, date):
</span></span><span style=display:flex><span><span style=color:#bd93f9>11</span>         <span style=color:#ff79c6>if</span> self<span style=color:#ff79c6>.</span>event_date <span style=color:#ff79c6>&gt;</span> date:
</span></span><span style=display:flex><span><span style=color:#bd93f9>12</span>             <span style=color:#ff79c6>return</span> <span style=color:#f1fa8c>&#34;Event is after this date&#34;</span>
</span></span><span style=display:flex><span><span style=color:#bd93f9>13</span>         <span style=color:#ff79c6>elif</span> self<span style=color:#ff79c6>.</span>event_date <span style=color:#ff79c6>==</span> date:
</span></span><span style=display:flex><span><span style=color:#bd93f9>14</span>             <span style=color:#ff79c6>return</span> <span style=color:#f1fa8c>&#34;Event is on the same day&#34;</span>
</span></span><span style=display:flex><span><span style=color:#bd93f9>15</span>         <span style=color:#ff79c6>else</span>:
</span></span><span style=display:flex><span><span style=color:#bd93f9>16</span>             <span style=color:#ff79c6>return</span> <span style=color:#f1fa8c>&#34;Event is befor this date&#34;</span>
</span></span><span style=display:flex><span><span style=color:#bd93f9>17</span> 
</span></span><span style=display:flex><span><span style=color:#bd93f9>18</span>     @property
</span></span><span style=display:flex><span><span style=color:#bd93f9>19</span>     <span style=color:#ff79c6>def</span> <span style=color:#50fa7b>name_slug</span>(self):
</span></span><span style=display:flex><span><span style=color:#bd93f9>20</span>         <span style=color:#ff79c6>return</span> self<span style=color:#ff79c6>.</span>name<span style=color:#ff79c6>.</span>lower()<span style=color:#ff79c6>.</span>replace(<span style=color:#f1fa8c>&#39; &#39;</span>,<span style=color:#f1fa8c>&#39;-&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#bd93f9>21</span> 
</span></span><span style=display:flex><span><span style=color:#bd93f9>22</span>     <span style=color:#ff79c6>def</span> __str__(self):
</span></span><span style=display:flex><span><span style=color:#bd93f9>23</span>         <span style=color:#ff79c6>return</span> self<span style=color:#ff79c6>.</span>name
</span></span></code></pre></div><p>Let‚Äôs have a look at what‚Äôs happening with this new code:</p><ul><li>In <strong>Line 10</strong> I have added a new method called <code>event_timing</code>. This is a straight forward method that compares the event date to the date passed to the method and returns a message stating whether the event occurs before, on or after the date.</li><li>In <strong>Line 19</strong> I have added another custom method that returns a slugified event name. The <strong><code>@property</code></strong> decorator on <strong>Line 18</strong> allows us to access the method directly, like an attribute. Without the <strong><code>@property</code></strong>, you would have to use a method call (<strong><code>name_slug()</code></strong>).</li></ul><p>Let‚Äôs test these new methods out in the Django interactive interpreter. Don‚Äôt forget to save the model before you start!</p><p>First, the <strong><code>name_slug</code></strong> method:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> <span style=color:#ff79c6>from</span> events.models <span style=color:#ff79c6>import</span> Event 
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> events <span style=color:#ff79c6>=</span> Event<span style=color:#ff79c6>.</span>events<span style=color:#ff79c6>.</span>all()
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> <span style=color:#ff79c6>for</span> event <span style=color:#ff79c6>in</span> events:
</span></span><span style=display:flex><span><span style=color:#ff79c6>...</span>     <span style=color:#8be9fd;font-style:italic>print</span>(event<span style=color:#ff79c6>.</span>name_slug)
</span></span><span style=display:flex><span><span style=color:#ff79c6>...</span> 
</span></span><span style=display:flex><span>test<span style=color:#ff79c6>-</span>event
</span></span><span style=display:flex><span>club<span style=color:#ff79c6>-</span>presentation<span style=color:#ff79c6>---</span>juniors
</span></span><span style=display:flex><span>club<span style=color:#ff79c6>-</span>presentation<span style=color:#ff79c6>---</span>seniors
</span></span><span style=display:flex><span>gala<span style=color:#ff79c6>-</span>day
</span></span></code></pre></div><p>This should be easy to follow. Notice how the <strong><code>@property</code></strong> decorator allows us to access the method directly like it was an attribute. I.e. <strong><code>event.name_slug</code></strong> instead of <strong><code>event.name_slug()</code></strong>.</p><p>Now to test the <strong><code>event_timing</code></strong> method:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> <span style=color:#ff79c6>from</span> datetime <span style=color:#ff79c6>import</span> datetime, timezone
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> e <span style=color:#ff79c6>=</span> Event<span style=color:#ff79c6>.</span>events<span style=color:#ff79c6>.</span>get(name<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;Gala Day&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> e<span style=color:#ff79c6>.</span>event_timing(datetime<span style=color:#ff79c6>.</span>now(timezone<span style=color:#ff79c6>.</span>utc))          
</span></span><span style=display:flex><span><span style=color:#f1fa8c>&#39;Event is befor this date&#39;</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span>
</span></span></code></pre></div><p>Too easy.</p><p><strong>Date and Time in Django</strong></p><p>Something to note when working with dates in Django. Django uses timezone aware dates, so if you are doing date comparisons like the in any of your code, not just in class methods, you can‚Äôt use <code>datetime.now()</code> as Django will throw a <code>TypeError: can't compare offset-naive and offset-aware datetimes</code>. To avoid this error, you must provide timezone information with your dates.</p><h3 id=overriding-default-model-methods>Overriding Default Model Methods<a hidden class=anchor aria-hidden=true href=#overriding-default-model-methods>#</a></h3><p>It‚Äôs common to want to override built-in model methods like <strong><code>save()</code></strong> and <strong><code>delete()</code></strong> to add business logic to default database behavior.</p><p>To override a built-in model method you define a new method with the same name. For, example, let‚Äôs override the <code>Event</code> model‚Äôs default <strong><code>save()</code></strong> method to automatically assign management of the event to a staff member (changes in bold):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#6272a4># myclub_rooteventsmodels.py</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4># ...</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#bd93f9>1</span>  <span style=color:#ff79c6>class</span> <span style=color:#50fa7b>Event</span>(models<span style=color:#ff79c6>.</span>Model):
</span></span><span style=display:flex><span><span style=color:#bd93f9>2</span>      name <span style=color:#ff79c6>=</span> models<span style=color:#ff79c6>.</span>CharField(<span style=color:#f1fa8c>&#39;Event Name&#39;</span>, max_length<span style=color:#ff79c6>=</span><span style=color:#bd93f9>120</span>)
</span></span><span style=display:flex><span><span style=color:#bd93f9>3</span>      event_date <span style=color:#ff79c6>=</span> models<span style=color:#ff79c6>.</span>DateTimeField(<span style=color:#f1fa8c>&#39;Event Date&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#bd93f9>4</span>      venue <span style=color:#ff79c6>=</span> models<span style=color:#ff79c6>.</span>ForeignKey(Venue, on_delete<span style=color:#ff79c6>=</span>models<span style=color:#ff79c6>.</span>CASCADE)
</span></span><span style=display:flex><span><span style=color:#bd93f9>5</span>      manager <span style=color:#ff79c6>=</span> models<span style=color:#ff79c6>.</span>ForeignKey(User, blank<span style=color:#ff79c6>=</span><span style=color:#ff79c6>True</span>, null<span style=color:#ff79c6>=</span><span style=color:#ff79c6>True</span>, on_delete<span style=color:#ff79c6>=</span>models<span style=color:#ff79c6>.</span>SET_NULL)
</span></span><span style=display:flex><span><span style=color:#bd93f9>6</span>      attendees <span style=color:#ff79c6>=</span> models<span style=color:#ff79c6>.</span>ManyToManyField(MyclubUser)
</span></span><span style=display:flex><span><span style=color:#bd93f9>7</span>      description <span style=color:#ff79c6>=</span> models<span style=color:#ff79c6>.</span>TextField(blank<span style=color:#ff79c6>=</span><span style=color:#ff79c6>True</span>)
</span></span><span style=display:flex><span><span style=color:#bd93f9>8</span>      events <span style=color:#ff79c6>=</span> EventManager()
</span></span><span style=display:flex><span><span style=color:#bd93f9>9</span>  
</span></span><span style=display:flex><span><span style=color:#bd93f9>10</span>     <span style=color:#ff79c6>def</span> <span style=color:#50fa7b>save</span>(self, <span style=color:#ff79c6>*</span>args, <span style=color:#ff79c6>**</span>kwargs):
</span></span><span style=display:flex><span><span style=color:#bd93f9>11</span>         self<span style=color:#ff79c6>.</span>manager <span style=color:#ff79c6>=</span> User<span style=color:#ff79c6>.</span>objects<span style=color:#ff79c6>.</span>get(username<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#39;abbyb&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#bd93f9>12</span>         <span style=color:#8be9fd;font-style:italic>super</span>(Event, self)<span style=color:#ff79c6>.</span>save(<span style=color:#ff79c6>*</span>args, <span style=color:#ff79c6>**</span>kwargs)
</span></span><span style=display:flex><span><span style=color:#6272a4># ...</span>
</span></span></code></pre></div><p>The new <strong><code>save()</code></strong> method starts on <strong>Line 10</strong>. In the overridden <code>save()</code> method, we‚Äôre first assigning the staff member with the username ‚Äúabbyb‚Äù to the <code>manager</code> field of the model instance (<strong>Line 11</strong>), and then we call the default <code>save()</code> method with the <strong><code>super()</code></strong> function to save the model instance to the database (<strong>Line 12</strong>).</p><p>Once you save your <strong><code>models.py</code></strong> file, you can test out the overridden model method in the Django interactive shell:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> <span style=color:#ff79c6>from</span> events.models <span style=color:#ff79c6>import</span> Event
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> <span style=color:#ff79c6>from</span> events.models <span style=color:#ff79c6>import</span> Venue
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> <span style=color:#ff79c6>from</span> datetime <span style=color:#ff79c6>import</span> datetime, timezone
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> v <span style=color:#ff79c6>=</span> Venue<span style=color:#ff79c6>.</span>venues<span style=color:#ff79c6>.</span>get(<span style=color:#8be9fd;font-style:italic>id</span><span style=color:#ff79c6>=</span><span style=color:#bd93f9>1</span>)
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> e <span style=color:#ff79c6>=</span> Event<span style=color:#ff79c6>.</span>events<span style=color:#ff79c6>.</span>create(name<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#39;New Event&#39;</span>, event_date<span style=color:#ff79c6>=</span>datetime<span style=color:#ff79c6>.</span>now(timezone<span style=color:#ff79c6>.</span>utc), venue<span style=color:#ff79c6>=</span>v)
</span></span></code></pre></div><p>Once the new record has been created, you can test to see if your override worked by checking the <code>manager</code> field of the <code>Event</code> object:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> e<span style=color:#ff79c6>.</span>manager
</span></span><span style=display:flex><span><span style=color:#ff79c6>&lt;</span>User: abbyb<span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span>
</span></span></code></pre></div><h2 id=model-inheritance>Model Inheritance<a hidden class=anchor aria-hidden=true href=#model-inheritance>#</a></h2><p>Models are simply Python classes, so inheritance works the same way as normal Python class inheritance. The two most common forms of model inheritance in Django are:</p><ol><li><strong>Multi-table inheritance</strong>, where each model has its own database table; and</li><li><strong>Abstract base classes</strong>, where the parent model holds information common to all its child classes, but doesn‚Äôt have a database table.</li></ol><p>You can also create proxy models that modify the Python-level behavior of a model without modifying the underlying model fields, however, we won‚Äôt be covering them here. See the <a href=https://docs.djangoproject.com/en/2.2/topics/db/models/#proxy-models>Django documentation</a> for more information on proxy models.</p><h3 id=multi-table-inheritance>Multi-table Inheritance<a hidden class=anchor aria-hidden=true href=#multi-table-inheritance>#</a></h3><p>Multi-table inheritance is straight forward‚Äîthe parent class is a normal model and the child inherits the parent by declaring the parent class in the child class declaration. For example:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff79c6>class</span> <span style=color:#50fa7b>MyclubUser</span>(models<span style=color:#ff79c6>.</span>Model):
</span></span><span style=display:flex><span>    first_name <span style=color:#ff79c6>=</span> models<span style=color:#ff79c6>.</span>CharField(max_length<span style=color:#ff79c6>=</span><span style=color:#bd93f9>30</span>)
</span></span><span style=display:flex><span>    last_name <span style=color:#ff79c6>=</span> models<span style=color:#ff79c6>.</span>CharField(max_length<span style=color:#ff79c6>=</span><span style=color:#bd93f9>30</span>)
</span></span><span style=display:flex><span>    email <span style=color:#ff79c6>=</span> models<span style=color:#ff79c6>.</span>EmailField(<span style=color:#f1fa8c>&#39;User Email&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>def</span> __str__(self):
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>return</span> self<span style=color:#ff79c6>.</span>first_name <span style=color:#ff79c6>+</span> <span style=color:#f1fa8c>&#34; &#34;</span> <span style=color:#ff79c6>+</span> self<span style=color:#ff79c6>.</span>last_name
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>class</span> <span style=color:#50fa7b>Subscriber</span>(MyclubUser):
</span></span><span style=display:flex><span>    date_joined <span style=color:#ff79c6>=</span> models<span style=color:#ff79c6>.</span>DateTimeField()
</span></span></code></pre></div><p>The parent model in the example is the <code>MyclubUser</code> model from our <code>events</code> app. The <code>Subscriber</code> model inherits from <code>MyclubUser</code> and adds an additional field (<code>date_joined</code>). As they are both standard Django model classes, a database table will be created for each model.</p><h3 id=abstract-base-classes>Abstract Base Classes<a hidden class=anchor aria-hidden=true href=#abstract-base-classes>#</a></h3><p>Abstract base classes are handy when you want to put common information into other models without having to create a database table for the base class.</p><p>You create an abstract base class by adding the <strong><code>abstract = True</code></strong> class <code>Meta</code> option (<strong>Line 7</strong> in this example):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#bd93f9>1</span>  <span style=color:#ff79c6>class</span> <span style=color:#50fa7b>UserBase</span>(models<span style=color:#ff79c6>.</span>Model):
</span></span><span style=display:flex><span><span style=color:#bd93f9>2</span>      first_name <span style=color:#ff79c6>=</span> models<span style=color:#ff79c6>.</span>CharField(max_length<span style=color:#ff79c6>=</span><span style=color:#bd93f9>30</span>)
</span></span><span style=display:flex><span><span style=color:#bd93f9>3</span>      last_name <span style=color:#ff79c6>=</span> models<span style=color:#ff79c6>.</span>CharField(max_length<span style=color:#ff79c6>=</span><span style=color:#bd93f9>30</span>)
</span></span><span style=display:flex><span><span style=color:#bd93f9>4</span>      email <span style=color:#ff79c6>=</span> models<span style=color:#ff79c6>.</span>EmailField(<span style=color:#f1fa8c>&#39;User Email&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#bd93f9>5</span>  
</span></span><span style=display:flex><span><span style=color:#bd93f9>6</span>      <span style=color:#ff79c6>class</span> <span style=color:#50fa7b>Meta</span>:
</span></span><span style=display:flex><span><span style=color:#bd93f9>7</span>          abstract <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>True</span>
</span></span><span style=display:flex><span><span style=color:#bd93f9>8</span>          ordering <span style=color:#ff79c6>=</span> [<span style=color:#f1fa8c>&#39;last_name&#39;</span>]
</span></span><span style=display:flex><span><span style=color:#bd93f9>9</span>  
</span></span><span style=display:flex><span><span style=color:#bd93f9>10</span> 
</span></span><span style=display:flex><span><span style=color:#bd93f9>11</span> <span style=color:#ff79c6>class</span> <span style=color:#50fa7b>MyclubUser</span>(UserBase):
</span></span><span style=display:flex><span><span style=color:#bd93f9>12</span>     <span style=color:#ff79c6>def</span> __str__(self):
</span></span><span style=display:flex><span><span style=color:#bd93f9>13</span>         <span style=color:#ff79c6>return</span> self<span style=color:#ff79c6>.</span>first_name <span style=color:#ff79c6>+</span> <span style=color:#f1fa8c>&#34; &#34;</span> <span style=color:#ff79c6>+</span> self<span style=color:#ff79c6>.</span>last_name
</span></span><span style=display:flex><span><span style=color:#bd93f9>14</span> 
</span></span><span style=display:flex><span><span style=color:#bd93f9>15</span> 
</span></span><span style=display:flex><span><span style=color:#bd93f9>16</span> <span style=color:#ff79c6>class</span> <span style=color:#50fa7b>Subscriber</span>(UserBase):
</span></span><span style=display:flex><span><span style=color:#bd93f9>17</span>     date_joined <span style=color:#ff79c6>=</span> models<span style=color:#ff79c6>.</span>DateTimeField()
</span></span></code></pre></div><p>Abstract base classes are also useful for declaring class <strong><code>Meta</code></strong> options that are inherited by all child models (<strong>Line 8</strong>).</p><p>As the <code>MyclubUser</code> model from our <code>events</code> app now inherits the first name, last name and email fields from <code>UserBase</code>, it only needs to declare the <strong><code>__str__()</code></strong> function to behave the same way as the original <strong><code>MyclubUser</code></strong> model we created earlier.</p><p>This example is very similar to the example for multi-table inheritance in the previous section, and if you saved and migrated these models, you would get exactly the same result as the above code ‚ÄîDjango would create the <strong><code>events_myclubuser</code></strong> and <strong><code>events_subscriber</code></strong> tables in your database, however, because <strong><code>UserBase</code></strong> is and abstract model, it won‚Äôt be added to the database as a table.</p><h2 id=references>References:<a hidden class=anchor aria-hidden=true href=#references>#</a></h2><ul><li><a href=https://raturi.in/blog/everything-about-django-orm-querysets-field-lookups-model-managers-aggregate-functions-tutorial/>https://raturi.in/blog/everything-about-django-orm-querysets-field-lookups-model-managers-aggregate-functions-tutorial/</a></li><li><a href="https://www.youtube.com/playlist?list=PLOLrQ9Pn6cazjoDEnwzcdWWf4SNS0QZml">https://www.youtube.com/playlist?list=PLOLrQ9Pn6cazjoDEnwzcdWWf4SNS0QZml</a></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://abotyim.github.io/en/tags/django/>Django</a></li><li><a href=https://abotyim.github.io/en/tags/django-orm/>Django-ORM</a></li><li><a href=https://abotyim.github.io/en/tags/orm/>ORM</a></li></ul><nav class=paginav><a class=prev href=https://abotyim.github.io/en/posts/resources/django/><span class=title>¬´ Prev Page</span><br><span>Django Web Framework</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Django ORM on twitter" href="https://twitter.com/intent/tweet/?text=Django%20ORM&url=https%3a%2f%2fabotyim.github.io%2fen%2fposts%2fdjango%2form%2f&hashtags=Django%2cDjango-ORM%2cORM"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Django ORM on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fabotyim.github.io%2fen%2fposts%2fdjango%2form%2f&title=Django%20ORM&summary=Django%20ORM&source=https%3a%2f%2fabotyim.github.io%2fen%2fposts%2fdjango%2form%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Django ORM on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fabotyim.github.io%2fen%2fposts%2fdjango%2form%2f&title=Django%20ORM"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Django ORM on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fabotyim.github.io%2fen%2fposts%2fdjango%2form%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Django ORM on whatsapp" href="https://api.whatsapp.com/send?text=Django%20ORM%20-%20https%3a%2f%2fabotyim.github.io%2fen%2fposts%2fdjango%2form%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Django ORM on telegram" href="https://telegram.me/share/url?text=Django%20ORM&url=https%3a%2f%2fabotyim.github.io%2fen%2fposts%2fdjango%2form%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://abotyim.github.io/en/>Abo Tyim</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="copy";function s(){t.innerText="copied!",setTimeout(()=>{t.innerText="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>